{"version":3,"sources":["webpack://WebrtcTroubleshooter/webpack/universalModuleDefinition","webpack://WebrtcTroubleshooter/webpack/bootstrap","webpack://WebrtcTroubleshooter/./node_modules/events/events.js","webpack://WebrtcTroubleshooter/./node_modules/getscreenmedia/getscreenmedia.js","webpack://WebrtcTroubleshooter/./node_modules/hark/hark.js","webpack://WebrtcTroubleshooter/./node_modules/inherits/inherits_browser.js","webpack://WebrtcTroubleshooter/./node_modules/localmedia/localmedia.js","webpack://WebrtcTroubleshooter/./node_modules/lodash.clonedeep/index.js","webpack://WebrtcTroubleshooter/./node_modules/mockconsole/mockconsole.js","webpack://WebrtcTroubleshooter/./node_modules/process/browser.js","webpack://WebrtcTroubleshooter/./node_modules/rtcpeerconnection-shim/rtcpeerconnection.js","webpack://WebrtcTroubleshooter/./node_modules/rtcpeerconnection/rtcpeerconnection.js","webpack://WebrtcTroubleshooter/./node_modules/sdp-jingle-json/index.js","webpack://WebrtcTroubleshooter/./node_modules/sdp-jingle-json/lib/parsers.js","webpack://WebrtcTroubleshooter/./node_modules/sdp-jingle-json/lib/senders.js","webpack://WebrtcTroubleshooter/./node_modules/sdp-jingle-json/lib/tojson.js","webpack://WebrtcTroubleshooter/./node_modules/sdp-jingle-json/lib/tosdp.js","webpack://WebrtcTroubleshooter/./node_modules/sdp/sdp.js","webpack://WebrtcTroubleshooter/./node_modules/util/support/isBufferBrowser.js","webpack://WebrtcTroubleshooter/./node_modules/util/util.js","webpack://WebrtcTroubleshooter/(webpack)/buildin/global.js","webpack://WebrtcTroubleshooter/(webpack)/buildin/module.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/adapter_core.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/adapter_factory.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/common_shim.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/edge/edge_shim.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/edge/getusermedia.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-adapter/src/js/utils.js","webpack://WebrtcTroubleshooter/./node_modules/webrtc-stats-gatherer/dist/webrtc-stats-gatherer.js","webpack://WebrtcTroubleshooter/./node_modules/wildemitter/wildemitter.js","webpack://WebrtcTroubleshooter/./src/defaultTests.js","webpack://WebrtcTroubleshooter/./src/diagnostics/AudioBandwidthTest.js","webpack://WebrtcTroubleshooter/./src/diagnostics/AudioTest.js","webpack://WebrtcTroubleshooter/./src/diagnostics/ConnectivityTest.js","webpack://WebrtcTroubleshooter/./src/diagnostics/DataThroughputTest.js","webpack://WebrtcTroubleshooter/./src/diagnostics/SymmetricNatTest.js","webpack://WebrtcTroubleshooter/./src/diagnostics/VideoBandwidthTest.js","webpack://WebrtcTroubleshooter/./src/diagnostics/VideoTest.js","webpack://WebrtcTroubleshooter/./src/index.js","webpack://WebrtcTroubleshooter/./src/utils/StatisticsAggregate.js","webpack://WebrtcTroubleshooter/./src/utils/Test.js","webpack://WebrtcTroubleshooter/./src/utils/TestSuite.js","webpack://WebrtcTroubleshooter/./src/utils/WebrtcCall.js","webpack://WebrtcTroubleshooter/./src/utils/parseCandidate.js","webpack://WebrtcTroubleshooter/./src/utils/testErrorCodes.js"],"names":["EventEmitter","_events","_maxListeners","undefined","module","exports","prototype","defaultMaxListeners","setMaxListeners","n","isNumber","isNaN","TypeError","emit","type","er","handler","len","args","i","listeners","error","isObject","length","arguments","Error","err","context","isUndefined","isFunction","call","Array","slice","apply","addListener","listener","m","newListener","push","warned","console","trace","on","once","fired","g","removeListener","list","position","splice","removeAllListeners","key","ret","listenerCount","evlistener","emitter","arg","adapter","require","constraints","cb","hasConstraints","callback","browserDetails","browser","sessionStorage","getScreenMediaJSExtensionId","chrome","runtime","sendMessage","id","data","sourceId","name","audio","video","mandatory","chromeMediaSource","maxWidth","window","screen","width","maxHeight","height","maxFrameRate","chromeMediaSourceId","navigator","mediaDevices","getUserMedia","then","stream","catch","cefGetScreenMedia","version","mediaSource","getDisplayMedia","WildEmitter","getMaxVolume","analyser","fftBins","maxVolume","Infinity","getFloatFrequencyData","ii","audioContextType","AudioContext","webkitAudioContext","audioContext","options","harker","smoothing","interval","threshold","play","history","running","sourceNode","createAnalyser","fftSize","smoothingTimeConstant","Float32Array","frequencyBinCount","jquery","HTMLAudioElement","HTMLVideoElement","createMediaElementSource","createMediaStreamSource","connect","destination","speaking","suspend","resume","Object","defineProperty","get","state","onstatechange","setThreshold","t","setInterval","stop","disconnect","speakingHistory","looper","setTimeout","currentVolume","shift","create","inherits","ctor","superCtor","super_","constructor","value","enumerable","writable","configurable","TempCtor","util","hark","getScreenMedia","mockconsole","isAllTracksEnded","getTracks","forEach","readyState","shouldWorkAroundFirefoxStopStream","mozGetUserMedia","match","userAgent","parseInt","LocalMedia","opts","config","detectSpeakingEvents","audioFallback","media","harkOptions","logger","item","hasOwnProperty","_log","log","bind","_logerror","localStreams","localScreens","_audioMonitors","_stopAudioMonitor","start","mediaConstraints","self","_setupAudioMonitor","track","addEventListener","_removeStream","stopStream","stopScreenShare","idx","indexOf","startScreenShare","mute","_audioEnabled","unmute","pauseVideo","_videoEnabled","resumeVideo","pause","bool","getAudioTracks","enabled","getVideoTracks","isAudioEnabled","isVideoEnabled","timeout","clearTimeout","volume","monitors","LARGE_ARRAY_SIZE","HASH_UNDEFINED","MAX_SAFE_INTEGER","argsTag","arrayTag","boolTag","dateTag","errorTag","funcTag","genTag","mapTag","numberTag","objectTag","promiseTag","regexpTag","setTag","stringTag","symbolTag","weakMapTag","arrayBufferTag","dataViewTag","float32Tag","float64Tag","int8Tag","int16Tag","int32Tag","uint8Tag","uint8ClampedTag","uint16Tag","uint32Tag","reRegExpChar","reFlags","reIsHostCtor","reIsUint","cloneableTags","freeGlobal","global","freeSelf","root","Function","freeExports","nodeType","freeModule","moduleExports","addMapEntry","map","pair","set","addSetEntry","add","arrayEach","array","iteratee","index","arrayPush","values","offset","arrayReduce","accumulator","initAccum","baseTimes","result","getValue","object","isHostObject","toString","e","mapToArray","size","overArg","func","transform","setToArray","arrayProto","funcProto","objectProto","coreJsData","maskSrcKey","uid","exec","keys","IE_PROTO","funcToString","objectToString","reIsNative","RegExp","replace","Buffer","Symbol","Uint8Array","getPrototype","getPrototypeOf","objectCreate","propertyIsEnumerable","nativeGetSymbols","getOwnPropertySymbols","nativeIsBuffer","isBuffer","nativeKeys","DataView","getNative","Map","Promise","Set","WeakMap","nativeCreate","dataViewCtorString","toSource","mapCtorString","promiseCtorString","setCtorString","weakMapCtorString","symbolProto","symbolValueOf","valueOf","Hash","entries","clear","entry","hashClear","__data__","hashDelete","has","hashGet","hashHas","hashSet","ListCache","listCacheClear","listCacheDelete","assocIndexOf","lastIndex","pop","listCacheGet","listCacheHas","listCacheSet","MapCache","mapCacheClear","mapCacheDelete","getMapData","mapCacheGet","mapCacheHas","mapCacheSet","Stack","stackClear","stackDelete","stackGet","stackHas","stackSet","cache","pairs","arrayLikeKeys","inherited","isArray","isArguments","String","skipIndexes","isIndex","assignValue","objValue","eq","baseAssign","source","copyObject","baseClone","isDeep","isFull","customizer","stack","isArr","initCloneArray","copyArray","tag","getTag","isFunc","cloneBuffer","initCloneObject","copySymbols","initCloneByTag","stacked","props","getAllKeys","subValue","baseCreate","proto","baseGetAllKeys","keysFunc","symbolsFunc","baseGetTag","baseIsNative","isMasked","pattern","test","baseKeys","isPrototype","buffer","copy","cloneArrayBuffer","arrayBuffer","byteLength","cloneDataView","dataView","byteOffset","cloneMap","cloneFunc","cloneRegExp","regexp","cloneSet","cloneSymbol","symbol","cloneTypedArray","typedArray","newValue","getSymbols","isKeyable","stubArray","ArrayBuffer","resolve","Ctor","ctorString","input","cloneDeep","other","isArrayLikeObject","isArrayLike","isLength","isObjectLike","stubFalse","methods","split","l","fn","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","concat","drainQueue","run","nextTick","Item","title","env","argv","versions","noop","off","prependListener","prependOnceListener","binding","cwd","chdir","dir","umask","SDPUtils","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","writeMediaSection","transceiver","caps","dtlsRole","sdp","writeRtpDescription","kind","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","trackId","_initialTrackId","msid","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","warn","isString","validTurn","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","toLowerCase","clockRate","numChannels","Math","min","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","makeError","description","code","NotSupportedError","InvalidStateError","InvalidAccessError","OperationError","addTrackToStreamAndFireEvent","addTrack","dispatchEvent","MediaStreamTrackEvent","removeTrackFromStreamAndFireEvent","removeTrack","fireAddTrack","pc","receiver","streams","trackEvent","Event","_dispatchEvent","RTCPeerConnection","_eventTarget","document","createDocumentFragment","method","canTrickleIceCandidates","needNegotiation","remoteStreams","_localDescription","_remoteDescription","iceConnectionState","connectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","event","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","alreadyExists","s","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","clonedStream","clone","clonedTrack","sender","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","bufferedCandidateEvents","bufferCandidates","end","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","ufrag","usernameFragment","serializedCandidate","writeCandidate","assign","parseCandidate","toJSON","sections","getMediaSections","getDescription","join","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","reject","sessionpart","splitSections","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","_updateSignalingState","receiverList","iceOptions","substr","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","default","nativeTrack","sid","close","newState","states","closed","checking","connected","completed","disconnected","failed","new","connecting","createOffer","numAudioTracks","numVideoTracks","offerOptions","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","remoteCodec","hdrExt","remoteExtensions","rHdrExt","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","hasRtx","c","reducedSize","addIceCandidate","candidateString","trim","getStats","selector","MediaStreamTrack","senderOrReceiver","promises","all","allStats","results","stats","ortcObjects","ortcObjectName","obj","nativeGetstats","nativeStats","mapStats","nativeMethod","SJJ","PeerConnection","enableChromeNativeSimulcast","appVersion","constraint","enableMultiStreamHacks","restrictBandwidth","andyetRestrictBandwidth","batchIceCandidates","andyetBatchIce","batchedIceCandidates","andyetFasterICE","eliminateDuplicateCandidates","andyetDontSignalCandidates","dontSignalCandidates","assumeSetLocalSuccess","andyetAssumeSetLocalSuccess","wtFirefox","andyetFirefoxMakesMeSad","firefoxcandidatebuffer","onremovetrack","_onIce","_onDataChannel","localDescription","contents","remoteDescription","debug","isInitiator","sdpSessionID","Date","now","useJingle","iceCredentials","local","remote","hadLocalStunCandidate","hadRemoteStunCandidate","hadLocalRelayCandidate","hadRemoteRelayCandidate","hadLocalIPv6Candidate","hadRemoteIPv6Candidate","_remoteDataChannels","_localDataChannels","_candidateBuffer","_role","localStream","_checkLocalCandidate","toCandidateJSON","_checkRemoteCandidate","processIce","update","jingle","contentNames","content","transport","candidates","mline","remoteContent","processCandidates","iceCandidate","toCandidateSDP","RTCIceCandidate","pwd","toSessionSDP","expandedOffer","toSessionJSON","line","handleOffer","application","googConferenceFlag","sources","unshift","hasBw","bandwidth","answerAudioOnly","OfferToReceiveAudio","OfferToReceiveVideo","_answer","answerBroadcastOnly","handleAnswer","sim","groups","sourceGroups","hasSim","group","semantics","newssrc","floor","random","rtxssrc","expandedAnswer","ice","expandedCandidate","already","address","creator","transportType","newCand","channel","createDataChannel","res","toSDP","toIncomingSDPOffer","session","toOutgoingSDPOffer","toIncomingSDPAnswer","toOutgoingSDPAnswer","toIncomingMediaSDPOffer","toMediaSDP","toOutgoingMediaSDPOffer","toIncomingMediaSDPAnswer","toOutgoingMediaSDPAnswer","toIncomingJSONOffer","creators","toOutgoingJSONOffer","toIncomingJSONAnswer","toOutgoingJSONAnswer","toIncomingMediaJSONOffer","toMediaJSON","toOutgoingMediaJSONOffer","toIncomingMediaJSONAnswer","toOutgoingMediaJSONAnswer","findLine","prefix","mediaLines","sessionLines","prefixLength","findLines","parts","parsed","formats","rtpmap","clockrate","channels","sctpmap","number","fmtp","kv","crypto","cipherSuite","keyParams","sessionParams","fingerprint","hash","extmap","idpart","sp","senders","rtcpfb","subtype","substring","generation","relAddr","relPort","tcpType","network","attribute","mslabel","label","initiator","incoming","responder","both","none","recvonly","sendonly","sendrecv","inactive","outgoing","SENDERS","parsers","idCounter","_setIdCounter","counter","groupLines","applicationType","payloads","encryption","feedback","fingerprints","sctp","trans","rtpmapLines","payload","fmtpLines","fbLines","cryptoLines","mux","extLines","ext","ssrcGroupLines","ssrcLines","msidLine","found","fingerprintLines","setup","fp","ufragLine","pwdLine","candidateLines","sctpmapLines","time","hasSources","pushedSetup","param","hdrExts","hdr","ssrcGroups","ssrcGroup","ssrcs","toUpperCase","blob","part","relatedAddress","relatedPort","parseIceOptions","parseRtpMap","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","writeFmtp","parseRtcpFb","writeRtcpFb","parseSsrcMedia","colon","parseFingerprint","algorithm","setupType","iceParameters","password","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","maxBitrate","remoteSsrc","rsize","spec","planB","sessId","sessVer","sessionId","parseMLine","fmt","parseOLine","username","sessionVersion","netType","addressType","fill","readUInt8","formatRegExp","format","f","objects","inspect","str","x","Number","_","isNull","deprecate","msg","noDeprecation","deprecated","throwDeprecation","traceDeprecation","debugs","debugEnviron","debuglog","NODE_DEBUG","pid","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styles","styleType","style","arrayToHash","val","recurseTimes","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","isDate","base","braces","toUTCString","output","formatArray","formatProperty","reduceToSingleString","simple","getOwnPropertyDescriptor","numLinesEst","reduce","prev","cur","ar","isNullOrUndefined","isSymbol","re","d","isPrimitive","o","pad","months","timestamp","getHours","getMinutes","getSeconds","getDate","getMonth","origin","prop","eval","webpackPolyfill","paths","children","adapterFactory","utils","dependencies","shimChrome","shimFirefox","shimEdge","shimSafari","logging","detectBrowser","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","extractVersion","disableLog","disableWarnings","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimSenderReceiverGetStats","fixNegotiationNeeded","shimRTCIceCandidate","shimMaxMessageSize","shimSendThrowTypeError","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","walkStats","resultSet","endsWith","filterStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","webkitMediaStream","_ontrack","origSetRemoteDescription","_ontrackpoly","te","r","wrapPeerConnectionEvent","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","origGetReceivers","receivers","srcElement","origGetStats","DOMException","URL","HTMLMediaElement","_srcObject","src","revokeObjectURL","createObjectURL","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","replaceExternalStreamId","isLegacyCall","origSetLocalDescription","origLocalDescription","isLocal","streamid","hasTrack","webkitRTCPeerConnection","pcConfig","pcConstraints","iceTransports","generateCertificate","OrigPeerConnection","newIceServers","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","names","makeMapStats","successCallbackWrapper_","promise","nativeAddIceCandidate","target","shimGetDisplayMedia","getSourceId","frameRate","constraintsToChrome_","cc","ideal","exact","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","remap","a","b","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","devices","dev","some","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMediaPromise_","kinds","getSources","device","groupId","echoCancellation","origGetUserMedia","cs","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","srcObject","nativeSetAttribute","setAttribute","RTCSctpTransport","_sctp","sctpInDescription","mLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","maxMessageSize","isFirefox","canSendMMS","remoteMMS","POSITIVE_INFINITY","wrapDcSend","dc","origDataChannelSend","origCreateDataChannel","dataChannel","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","replaceTrack","setTrack","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","DataChannel","RTCDataChannel","preferredMediaSource","InternalError","SecurityError","constraintsToFF37_","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","uastring","expr","pos","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","oldMethod","newMethod","webpackUniversalModuleDefinition","factory","modules","installedModules","__webpack_require__","moduleId","getter","toStringTag","mode","__esModule","ns","getDefault","getModuleExports","property","_createClass","defineProperties","descriptor","Constructor","protoProps","staticProps","_classCallCheck","instance","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","setPrototypeOf","__proto__","IS_BROWSER","StatsGatherer","_EventEmitter","peerConnection","_this","connection","conference","statsInterval","lastResult","lastActiveLocalCandidate","_pollingInterval","_haveConnectionMetrics","_iceStartTime","_iceConnectionTime","traceData","collectTraces","_polyFillStats","betterResults","RTCStatsReport","_gatherStats","peerconnection","_checkLastActiveCandidate","_ref","localId","remoteId","lastActiveRemoteCandidate","_processReport","_ref2","_this2","googTrackId","mediaType","activeSource","bytesSent","bytesReceived","selected","specSepected","nominated","chromeSelected","googActiveConnection","localCandidateId","remoteCandidateId","localCandidateChanged","remoteCandidateChanged","networkType","candidatePair","candidateType","lastResultReport","muted","googCodecName","bytes","previousBytesTotal","deltaTime","bitrate","rtt","googRtt","mozRtt","roundTripTime","jitter","googJitterReceived","mozJitterReceived","lost","previousLost","total","previousTotal","remoteItem","packetsLost","packetsSent","packetsReceived","loss","intervalLoss","trackInfo","aecDivergentFilterFraction","googEchoCanellationEchoDelayMedian","googEchoCancellationEchoDelayStdDev","googEchoCancellationReturnLoss","googEchoCancellationReturnLossEnhancement","audioInputLevel","remoteTracks","_createStatsReport","updateLastResult","_this3","_this4","traces","collectStats","_this5","statsPoll","clearInterval","collectInitialConnectionStats","_this6","performance","platform","cores","hardwareConcurrency","connectTime","hadremoteRelayCandidate","activeCandidatePair","activeCandidatePairId","_ref3","selectedCandidatePairId","dtlsCipher","srtpCipher","localCandidate","_ref4","localCandidateType","remoteCandidateType","candidatePairDetails","turnTypes","turnType","usingIPv6","ipAddress","_iceFailedTime","failTime","_iceFailureTime","iceRW","numLocalHostCandidates","numLocalSrflxCandidates","numLocalRelayCandidates","numRemoteHostCandidates","numRemoteSrflxCandidates","numRemoteRelayCandidates","_ref5","googWritable","googReadable","localCandidates","remoteCandidates","mixin","isWildEmitter","groupName","callbacks","hasGroup","_groupName","releaseGroup","handlers","specialCallbacks","getWildcardCallbacks","eventName","AudioTest","VideoTest","ConnectivityTest","ThroughputTest","VideoBandwidthTest","AudioBandwidthTest","SymmetricNatTest","maxAudioBitrateKbps","durationMs","statStepMs","bweStats","StatisticsAggregate","rttStats","startTime","mediaOptions","iceConfig","pcCode","ERROR_CODES","ICE","details","WebrtcCall","setIceCandidateFilter","isRelay","doGetUserMedia","setupCall","runTest","hasError","getResults","MEDIA","level","addLog","status","audioTrack","getDeviceName","pc1","establishConnection","nextTimeout","gatherStats","gotStats","availableOutgoingBitrate","totalRoundTripTime","frameWidth","videoStats","frameHeight","mbpsAvg","getAverage","mbpsMax","getMax","rttAverage","rttMax","packetLoss","parseFloat","Test","MIC_DETECTION_THRESHOLD","volumeTimeout","localMedia","volumeCheckFailure","iceServer","logIceServers","pc2","connectivityCheckFailure","messageQueue","messageQueue2","messagesReceived","onmessage","msgEvent","onopen","DataChannelThroughputTest","testDurationSeconds","sentPayloadBytes","receivedPayloadBytes","stopSending","makeString","samplePacket","maxNumberOfPacketsToSend","bytesToKeepBuffered","lastBitrateMeasureTime","lastReceivedPayloadBytes","senderChannel","receiveChannel","sendingStep","onReceiverChannel","onMessageReceived","bufferedAmount","throughputTimeout","round","elapsedTime","receivedKBits","relatedPorts","ports","hasAsymmetric","hasSymmetric","onendofcandidates","maxVideoBitrateKbps","providedStream","screenStream","disableVideoFec","constrainVideoBitrate","gotStream","camera","isWebkit","documentElement","resolution","rampUpTimeMs","getRampUpTime","framerateMean","bitrateMean","mbpsStdDev","bitrateStdDev","lostPackets","videoTrack","TestSuite","rampUpThreshold","sum","count","rampUpTime","datapoint","deferred","allTestsComplete","stopOnFailure","runNextTest","activeTest","next","destroy","errInfo","WebrtcStatsGather","pc1Gatherer","pc2Gatherer","onIceCandidate","iceCandidateFilter","noFilter","gotOffer","statsCollectTime","getStatsTimeout","gotAnswer","constrainVideoBitrateKbps","otherPeer","text","candidateStr","fields","constrainOfferToRemoveVideoFec"],"mappings":"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","file":"webrtc-troubleshooter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebrtcTroubleshooter\"] = factory();\n\telse\n\t\troot[\"WebrtcTroubleshooter\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var adapter = require('webrtc-adapter');\n\nmodule.exports = function (constraints, cb) {\n    var hasConstraints = arguments.length === 2;\n    var callback = hasConstraints ? cb : constraints;\n    var error;\n\n    if (adapter.browserDetails.browser === 'chrome') {\n        // check that the extension is installed by looking for a\n        // sessionStorage variable that contains the extension id\n        // this has to be set after installation unless the content\n        // script does that\n        if (sessionStorage.getScreenMediaJSExtensionId) {\n            chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,\n                {type:'getScreen', id: 1}, null,\n                function (data) {\n                    if (!data || data.sourceId === '') { // user canceled\n                        var error = new Error('NavigatorUserMediaError');\n                        error.name = 'NotAllowedError';\n                        callback(error);\n                    } else {\n                        constraints = (hasConstraints && constraints) || {audio: false, video: {\n                            mandatory: {\n                                chromeMediaSource: 'desktop',\n                                maxWidth: window.screen.width,\n                                maxHeight: window.screen.height,\n                                maxFrameRate: 3\n                            }\n                        }};\n                        constraints.video.mandatory.chromeMediaSourceId = data.sourceId;\n                        window.navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n                            callback(null, stream);\n                        }).catch(function (err) {\n                            callback(err);\n                        });\n                    }\n                }\n            );\n        } else if (window.cefGetScreenMedia) {\n            //window.cefGetScreenMedia is experimental - may be removed without notice\n            window.cefGetScreenMedia(function(sourceId) {\n                if (!sourceId) {\n                    var error = new Error('cefGetScreenMediaError');\n                    error.name = 'CEF_GETSCREENMEDIA_CANCELED';\n                    callback(error);\n                } else {\n                    constraints = (hasConstraints && constraints) || {audio: false, video: {\n                        mandatory: {\n                            chromeMediaSource: 'desktop',\n                            maxWidth: window.screen.width,\n                            maxHeight: window.screen.height,\n                            maxFrameRate: 3\n                        }\n                    }};\n                    constraints.video.mandatory.chromeMediaSourceId = sourceId;\n                    window.navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n                        callback(null, stream);\n                    }).catch(function (err) {\n                        callback(err);\n                    });\n                }\n            });\n        } else {\n            error = new Error('Screensharing is not supported');\n            error.name = 'NotSupportedError';\n            callback(error);\n        }\n    } else if (adapter.browserDetails.browser === 'firefox' && adapter.browserDetails.version >= 33) {\n        constraints = (hasConstraints && constraints) || {\n            video: {\n                mediaSource: 'window'\n            }\n        };\n        window.navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n            callback(null, stream);\n        }).catch(function (err) {\n            callback(err);\n        });\n    } else if (adapter.browserDetails.browser === 'edge' && 'getDisplayMedia' in window.navigator) {\n        window.navigator.getDisplayMedia({video: true}).then(function (stream) {\n            callback(null, stream);\n        }).catch(function (err) {\n            callback(err);\n        });\n    } else {\n        error = new Error('Screensharing is not supported');\n        error.name = 'NotSupportedError';\n        callback(error);\n    }\n};\n","var WildEmitter = require('wildemitter');\n\nfunction getMaxVolume (analyser, fftBins) {\n  var maxVolume = -Infinity;\n  analyser.getFloatFrequencyData(fftBins);\n\n  for(var i=4, ii=fftBins.length; i < ii; i++) {\n    if (fftBins[i] > maxVolume && fftBins[i] < 0) {\n      maxVolume = fftBins[i];\n    }\n  };\n\n  return maxVolume;\n}\n\n\nvar audioContextType;\nif (typeof window !== 'undefined') {\n  audioContextType = window.AudioContext || window.webkitAudioContext;\n}\n// use a single audio context due to hardware limits\nvar audioContext = null;\nmodule.exports = function(stream, options) {\n  var harker = new WildEmitter();\n\n\n  // make it not break in non-supported browsers\n  if (!audioContextType) return harker;\n\n  //Config\n  var options = options || {},\n      smoothing = (options.smoothing || 0.1),\n      interval = (options.interval || 50),\n      threshold = options.threshold,\n      play = options.play,\n      history = options.history || 10,\n      audioContext = options.audioContext || null,\n      running = true;\n\n  //Setup Audio Context\n  if (!audioContext) {\n    audioContext = new audioContextType();\n  }\n  var sourceNode, fftBins, analyser;\n\n  analyser = audioContext.createAnalyser();\n  analyser.fftSize = 512;\n  analyser.smoothingTimeConstant = smoothing;\n  fftBins = new Float32Array(analyser.frequencyBinCount);\n\n  if (stream.jquery) stream = stream[0];\n  if (stream instanceof HTMLAudioElement || stream instanceof HTMLVideoElement) {\n    //Audio Tag\n    sourceNode = audioContext.createMediaElementSource(stream);\n    if (typeof play === 'undefined') play = true;\n    threshold = threshold || -50;\n  } else {\n    //WebRTC Stream\n    sourceNode = audioContext.createMediaStreamSource(stream);\n    threshold = threshold || -50;\n  }\n\n  sourceNode.connect(analyser);\n  if (play) analyser.connect(audioContext.destination);\n\n  harker.speaking = false;\n\n  harker.suspend = function() {\n    return audioContext.suspend();\n  }\n  harker.resume = function() {\n    return audioContext.resume();\n  }\n  Object.defineProperty(harker, 'state', { get: function() {\n    return audioContext.state;\n  }});\n  audioContext.onstatechange = function() {\n    harker.emit('state_change', audioContext.state);\n  }\n\n  harker.setThreshold = function(t) {\n    threshold = t;\n  };\n\n  harker.setInterval = function(i) {\n    interval = i;\n  };\n\n  harker.stop = function() {\n    running = false;\n    harker.emit('volume_change', -100, threshold);\n    if (harker.speaking) {\n      harker.speaking = false;\n      harker.emit('stopped_speaking');\n    }\n    analyser.disconnect();\n    sourceNode.disconnect();\n  };\n  harker.speakingHistory = [];\n  for (var i = 0; i < history; i++) {\n      harker.speakingHistory.push(0);\n  }\n\n  // Poll the analyser node to determine if speaking\n  // and emit events if changed\n  var looper = function() {\n    setTimeout(function() {\n\n      //check if stop has been called\n      if(!running) {\n        return;\n      }\n\n      var currentVolume = getMaxVolume(analyser, fftBins);\n\n      harker.emit('volume_change', currentVolume, threshold);\n\n      var history = 0;\n      if (currentVolume > threshold && !harker.speaking) {\n        // trigger quickly, short history\n        for (var i = harker.speakingHistory.length - 3; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n        if (history >= 2) {\n          harker.speaking = true;\n          harker.emit('speaking');\n        }\n      } else if (currentVolume < threshold && harker.speaking) {\n        for (var i = 0; i < harker.speakingHistory.length; i++) {\n          history += harker.speakingHistory[i];\n        }\n        if (history == 0) {\n          harker.speaking = false;\n          harker.emit('stopped_speaking');\n        }\n      }\n      harker.speakingHistory.shift();\n      harker.speakingHistory.push(0 + (currentVolume > threshold));\n\n      looper();\n    }, interval);\n  };\n  looper();\n\n\n  return harker;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","var util = require('util');\nvar hark = require('hark');\nvar getScreenMedia = require('getscreenmedia');\nvar WildEmitter = require('wildemitter');\nvar mockconsole = require('mockconsole');\n\nfunction isAllTracksEnded(stream) {\n    var isAllTracksEnded = true;\n    stream.getTracks().forEach(function (t) {\n        isAllTracksEnded = t.readyState === 'ended' && isAllTracksEnded;\n    });\n    return isAllTracksEnded;\n}\n\nfunction shouldWorkAroundFirefoxStopStream() {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n  if (!window.navigator.mozGetUserMedia) {\n    return false;\n  }\n  var match = window.navigator.userAgent.match(/Firefox\\/(\\d+)\\./);\n  var version = match && match.length >= 1 && parseInt(match[1], 10);\n  return version < 50;\n}\n\nfunction LocalMedia(opts) {\n    WildEmitter.call(this);\n\n    var config = this.config = {\n        detectSpeakingEvents: false,\n        audioFallback: false,\n        media: {\n            audio: true,\n            video: true\n        },\n        harkOptions: null,\n        logger: mockconsole\n    };\n\n    var item;\n    for (item in opts) {\n        if (opts.hasOwnProperty(item)) {\n            this.config[item] = opts[item];\n        }\n    }\n\n    this.logger = config.logger;\n    this._log = this.logger.log.bind(this.logger, 'LocalMedia:');\n    this._logerror = this.logger.error.bind(this.logger, 'LocalMedia:');\n\n    this.localStreams = [];\n    this.localScreens = [];\n\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        this._logerror('Your browser does not support local media capture.');\n    }\n\n    this._audioMonitors = [];\n    this.on('localStreamStopped', this._stopAudioMonitor.bind(this));\n    this.on('localScreenStopped', this._stopAudioMonitor.bind(this));\n}\n\nutil.inherits(LocalMedia, WildEmitter);\n\n\nLocalMedia.prototype.start = function (mediaConstraints, cb) {\n    var self = this;\n    var constraints = mediaConstraints || this.config.media;\n\n    this.emit('localStreamRequested', constraints);\n\n    navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n        if (constraints.audio && self.config.detectSpeakingEvents) {\n            self._setupAudioMonitor(stream, self.config.harkOptions);\n        }\n        self.localStreams.push(stream);\n\n        stream.getTracks().forEach(function (track) {\n            track.addEventListener('ended', function () {\n                if (isAllTracksEnded(stream)) {\n                    self._removeStream(stream);\n                }\n            });\n        });\n\n        self.emit('localStream', stream);\n\n        if (cb) {\n            return cb(null, stream);\n        }\n    }).catch(function (err) {\n            // Fallback for users without a camera\n            if (self.config.audioFallback && err.name === 'NotFoundError' && constraints.video !== false) {\n                constraints.video = false;\n                self.start(constraints, cb);\n                return;\n            }\n\n        self.emit('localStreamRequestFailed', constraints);\n\n        if (cb) {\n            return cb(err, null);\n        }\n    });\n};\n\nLocalMedia.prototype.stop = function (stream) {\n    this.stopStream(stream);\n    this.stopScreenShare(stream);\n};\n\nLocalMedia.prototype.stopStream = function (stream) {\n    var self = this;\n\n    if (stream) {\n        var idx = this.localStreams.indexOf(stream);\n        if (idx > -1) {\n            stream.getTracks().forEach(function (track) { track.stop(); });\n\n            //Half-working fix for Firefox, see: https://bugzilla.mozilla.org/show_bug.cgi?id=1208373\n            if (shouldWorkAroundFirefoxStopStream()) {\n                this._removeStream(stream);\n            }\n        }\n    } else {\n        this.localStreams.forEach(function (stream) {\n            stream.getTracks().forEach(function (track) { track.stop(); });\n\n            //Half-working fix for Firefox, see: https://bugzilla.mozilla.org/show_bug.cgi?id=1208373\n            if (shouldWorkAroundFirefoxStopStream()) {\n                self._removeStream(stream);\n            }\n        });\n    }\n};\n\nLocalMedia.prototype.startScreenShare = function (constraints, cb) {\n    var self = this;\n\n    this.emit('localScreenRequested');\n\n    if (typeof constraints === 'function' && !cb) {\n        cb = constraints;\n        constraints = null;\n    }\n\n    getScreenMedia(constraints, function (err, stream) {\n        if (!err) {\n            self.localScreens.push(stream);\n\n            stream.getTracks().forEach(function (track) {\n                track.addEventListener('ended', function () {\n                    var isAllTracksEnded = true;\n                    stream.getTracks().forEach(function (t) {\n                        isAllTracksEnded = t.readyState === 'ended' && isAllTracksEnded;\n                    });\n\n                    if (isAllTracksEnded) {\n                        self._removeStream(stream);\n                    }\n                });\n            });\n\n            self.emit('localScreen', stream);\n        } else {\n            self.emit('localScreenRequestFailed');\n        }\n\n        // enable the callback\n        if (cb) {\n            return cb(err, stream);\n        }\n    });\n};\n\nLocalMedia.prototype.stopScreenShare = function (stream) {\n    var self = this;\n\n    if (stream) {\n        var idx = this.localScreens.indexOf(stream);\n        if (idx > -1) {\n            stream.getTracks().forEach(function (track) { track.stop(); });\n\n            //Half-working fix for Firefox, see: https://bugzilla.mozilla.org/show_bug.cgi?id=1208373\n            if (shouldWorkAroundFirefoxStopStream()) {\n                this._removeStream(stream);\n            }\n        }\n    } else {\n        this.localScreens.forEach(function (stream) {\n            stream.getTracks().forEach(function (track) { track.stop(); });\n\n            //Half-working fix for Firefox, see: https://bugzilla.mozilla.org/show_bug.cgi?id=1208373\n            if (shouldWorkAroundFirefoxStopStream()) {\n                self._removeStream(stream);\n            }\n        });\n    }\n};\n\n// Audio controls\nLocalMedia.prototype.mute = function () {\n    this._audioEnabled(false);\n    this.emit('audioOff');\n};\n\nLocalMedia.prototype.unmute = function () {\n    this._audioEnabled(true);\n    this.emit('audioOn');\n};\n\n// Video controls\nLocalMedia.prototype.pauseVideo = function () {\n    this._videoEnabled(false);\n    this.emit('videoOff');\n};\nLocalMedia.prototype.resumeVideo = function () {\n    this._videoEnabled(true);\n    this.emit('videoOn');\n};\n\n// Combined controls\nLocalMedia.prototype.pause = function () {\n    this.mute();\n    this.pauseVideo();\n};\nLocalMedia.prototype.resume = function () {\n    this.unmute();\n    this.resumeVideo();\n};\n\n// Internal methods for enabling/disabling audio/video\nLocalMedia.prototype._audioEnabled = function (bool) {\n    this.localStreams.forEach(function (stream) {\n        stream.getAudioTracks().forEach(function (track) {\n            track.enabled = !!bool;\n        });\n    });\n};\nLocalMedia.prototype._videoEnabled = function (bool) {\n    this.localStreams.forEach(function (stream) {\n        stream.getVideoTracks().forEach(function (track) {\n            track.enabled = !!bool;\n        });\n    });\n};\n\n// check if all audio streams are enabled\nLocalMedia.prototype.isAudioEnabled = function () {\n    var enabled = true;\n    this.localStreams.forEach(function (stream) {\n        stream.getAudioTracks().forEach(function (track) {\n            enabled = enabled && track.enabled;\n        });\n    });\n    return enabled;\n};\n\n// check if all video streams are enabled\nLocalMedia.prototype.isVideoEnabled = function () {\n    var enabled = true;\n    this.localStreams.forEach(function (stream) {\n        stream.getVideoTracks().forEach(function (track) {\n            enabled = enabled && track.enabled;\n        });\n    });\n    return enabled;\n};\n\nLocalMedia.prototype._removeStream = function (stream) {\n    var idx = this.localStreams.indexOf(stream);\n    if (idx > -1) {\n        this.localStreams.splice(idx, 1);\n        this.emit('localStreamStopped', stream);\n    } else {\n        idx = this.localScreens.indexOf(stream);\n        if (idx > -1) {\n            this.localScreens.splice(idx, 1);\n            this.emit('localScreenStopped', stream);\n        }\n    }\n};\n\nLocalMedia.prototype._setupAudioMonitor = function (stream, harkOptions) {\n    this._log('Setup audio');\n    var audio = hark(stream, harkOptions);\n    var self = this;\n    var timeout;\n\n    audio.on('speaking', function () {\n        self.emit('speaking');\n    });\n\n    audio.on('stopped_speaking', function () {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n\n        timeout = setTimeout(function () {\n            self.emit('stoppedSpeaking');\n        }, 1000);\n    });\n    audio.on('volume_change', function (volume, threshold) {\n        self.emit('volumeChange', volume, threshold);\n    });\n\n    this._audioMonitors.push({audio: audio, stream: stream});\n};\n\nLocalMedia.prototype._stopAudioMonitor = function (stream) {\n    var idx = -1;\n    this._audioMonitors.forEach(function (monitors, i) {\n        if (monitors.stream === stream) {\n            idx = i;\n        }\n    });\n\n    if (idx > -1) {\n        this._audioMonitors[idx].audio.stop();\n        this._audioMonitors.splice(idx, 1);\n    }\n};\n\nmodule.exports = LocalMedia;\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/**\n * Adds the key-value `pair` to `map`.\n *\n * @private\n * @param {Object} map The map to modify.\n * @param {Array} pair The key-value pair to add.\n * @returns {Object} Returns `map`.\n */\nfunction addMapEntry(map, pair) {\n  // Don't return `map.set` because it's not chainable in IE 11.\n  map.set(pair[0], pair[1]);\n  return map;\n}\n\n/**\n * Adds `value` to `set`.\n *\n * @private\n * @param {Object} set The set to modify.\n * @param {*} value The value to add.\n * @returns {Object} Returns `set`.\n */\nfunction addSetEntry(set, value) {\n  // Don't return `set.add` because it's not chainable in IE 11.\n  set.add(value);\n  return set;\n}\n\n/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/**\n * A specialized version of `_.reduce` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @param {*} [accumulator] The initial value.\n * @param {boolean} [initAccum] Specify using the first element of `array` as\n *  the initial value.\n * @returns {*} Returns the accumulated value.\n */\nfunction arrayReduce(array, iteratee, accumulator, initAccum) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  if (initAccum && length) {\n    accumulator = array[++index];\n  }\n  while (++index < length) {\n    accumulator = iteratee(accumulator, array[index], index, array);\n  }\n  return accumulator;\n}\n\n/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    Symbol = root.Symbol,\n    Uint8Array = root.Uint8Array,\n    getPrototype = overArg(Object.getPrototypeOf, Object),\n    objectCreate = Object.create,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols,\n    nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,\n    nativeKeys = overArg(Object.keys, Object);\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView'),\n    Map = getNative(root, 'Map'),\n    Promise = getNative(root, 'Promise'),\n    Set = getNative(root, 'Set'),\n    WeakMap = getNative(root, 'WeakMap'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  this.__data__ = new ListCache(entries);\n}\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n}\n\n/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  return this.__data__['delete'](key);\n}\n\n/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\n/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var cache = this.__data__;\n  if (cache instanceof ListCache) {\n    var pairs = cache.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      return this;\n    }\n    cache = this.__data__ = new MapCache(pairs);\n  }\n  cache.set(key, value);\n  return this;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  // Safari 9 makes `arguments.length` enumerable in strict mode.\n  var result = (isArray(value) || isArguments(value))\n    ? baseTimes(value.length, String)\n    : [];\n\n  var length = result.length,\n      skipIndexes = !!length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    object[key] = value;\n  }\n}\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @param {boolean} [isFull] Specify a clone including symbols.\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, isDeep, isFull, customizer, key, object, stack) {\n  var result;\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      if (isHostObject(value)) {\n        return object ? value : {};\n      }\n      result = initCloneObject(isFunc ? {} : value);\n      if (!isDeep) {\n        return copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, baseClone, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (!isArr) {\n    var props = isFull ? getAllKeys(value) : keys(value);\n  }\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, isDeep, isFull, customizer, key, value, stack));\n  });\n  return result;\n}\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} prototype The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nfunction baseCreate(proto) {\n  return isObject(proto) ? objectCreate(proto) : {};\n}\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\n/**\n * The base implementation of `getTag`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  return objectToString.call(value);\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var result = new buffer.constructor(buffer.length);\n  buffer.copy(result);\n  return result;\n}\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\n/**\n * Creates a clone of `map`.\n *\n * @private\n * @param {Object} map The map to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned map.\n */\nfunction cloneMap(map, isDeep, cloneFunc) {\n  var array = isDeep ? cloneFunc(mapToArray(map), true) : mapToArray(map);\n  return arrayReduce(array, addMapEntry, new map.constructor);\n}\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\n/**\n * Creates a clone of `set`.\n *\n * @private\n * @param {Object} set The set to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned set.\n */\nfunction cloneSet(set, isDeep, cloneFunc) {\n  var array = isDeep ? cloneFunc(setToArray(set), true) : setToArray(set);\n  return arrayReduce(array, addSetEntry, new set.constructor);\n}\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\n/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    assignValue(object, key, newValue === undefined ? source[key] : newValue);\n  }\n  return object;\n}\n\n/**\n * Copies own symbol properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Creates an array of the own enumerable symbol properties of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = nativeGetSymbols ? overArg(nativeGetSymbols, Object) : stubArray;\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11,\n// for data views in Edge < 14, and promises in Node.js.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = objectToString.call(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : undefined;\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, cloneFunc, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return cloneMap(object, isDeep, cloneFunc);\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return cloneSet(object, isDeep, cloneFunc);\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, true, true);\n}\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\n/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\n/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = cloneDeep;\n","var methods = \"assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn\".split(\",\");\nvar l = methods.length;\nvar fn = function () {};\nvar mockconsole = {};\n\nwhile (l--) {\n    mockconsole[methods[l]] = fn;\n}\n\nmodule.exports = mockconsole;\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n","var util = require('util');\nvar SJJ = require('sdp-jingle-json');\nvar WildEmitter = require('wildemitter');\nvar cloneDeep = require('lodash.clonedeep');\n\nfunction PeerConnection(config, constraints) {\n    var self = this;\n    var item;\n    WildEmitter.call(this);\n\n    config = config || {};\n    config.iceServers = config.iceServers || [];\n\n    // make sure this only gets enabled in Google Chrome\n    // EXPERIMENTAL FLAG, might get removed without notice\n    this.enableChromeNativeSimulcast = false;\n    if (constraints && constraints.optional && window.chrome &&\n            navigator.appVersion.match(/Chromium\\//) === null) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.enableChromeNativeSimulcast) {\n                self.enableChromeNativeSimulcast = true;\n            }\n        });\n    }\n\n    // EXPERIMENTAL FLAG, might get removed without notice\n    this.enableMultiStreamHacks = false;\n    if (constraints && constraints.optional && window.chrome) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.enableMultiStreamHacks) {\n                self.enableMultiStreamHacks = true;\n            }\n        });\n    }\n    // EXPERIMENTAL FLAG, might get removed without notice\n    this.restrictBandwidth = 0;\n    if (constraints && constraints.optional) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.andyetRestrictBandwidth) {\n                self.restrictBandwidth = constraint.andyetRestrictBandwidth;\n            }\n        });\n    }\n\n    // EXPERIMENTAL FLAG, might get removed without notice\n    // bundle up ice candidates, only works for jingle mode\n    // number > 0 is the delay to wait for additional candidates\n    // ~20ms seems good\n    this.batchIceCandidates = 0;\n    if (constraints && constraints.optional) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.andyetBatchIce) {\n                self.batchIceCandidates = constraint.andyetBatchIce;\n            }\n        });\n    }\n    this.batchedIceCandidates = [];\n\n    // EXPERIMENTAL FLAG, might get removed without notice\n    // this attemps to strip out candidates with an already known foundation\n    // and type -- i.e. those which are gathered via the same TURN server\n    // but different transports (TURN udp, tcp and tls respectively)\n    if (constraints && constraints.optional && window.chrome) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.andyetFasterICE) {\n                self.eliminateDuplicateCandidates = constraint.andyetFasterICE;\n            }\n        });\n    }\n    // EXPERIMENTAL FLAG, might get removed without notice\n    // when using a server such as the jitsi videobridge we don't need to signal\n    // our candidates\n    if (constraints && constraints.optional) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.andyetDontSignalCandidates) {\n                self.dontSignalCandidates = constraint.andyetDontSignalCandidates;\n            }\n        });\n    }\n\n\n    // EXPERIMENTAL FLAG, might get removed without notice\n    this.assumeSetLocalSuccess = false;\n    if (constraints && constraints.optional) {\n        constraints.optional.forEach(function (constraint) {\n            if (constraint.andyetAssumeSetLocalSuccess) {\n                self.assumeSetLocalSuccess = constraint.andyetAssumeSetLocalSuccess;\n            }\n        });\n    }\n\n    // EXPERIMENTAL FLAG, might get removed without notice\n    // working around https://bugzilla.mozilla.org/show_bug.cgi?id=1087551\n    // pass in a timeout for this\n    if (window.navigator.mozGetUserMedia) {\n        if (constraints && constraints.optional) {\n            this.wtFirefox = 0;\n            constraints.optional.forEach(function (constraint) {\n                if (constraint.andyetFirefoxMakesMeSad) {\n                    self.wtFirefox = constraint.andyetFirefoxMakesMeSad;\n                    if (self.wtFirefox > 0) {\n                        self.firefoxcandidatebuffer = [];\n                    }\n                }\n            });\n        }\n    }\n\n\n    this.pc = new RTCPeerConnection(config, constraints);\n\n    if (typeof this.pc.getLocalStreams === 'function') {\n        this.getLocalStreams = this.pc.getLocalStreams.bind(this.pc);\n    } else {\n        this.getLocalStreams = function () {\n            return [];\n        };\n    }\n\n    if (typeof this.pc.getRemoteStreams === 'function') {\n        this.getRemoteStreams = this.pc.getRemoteStreams.bind(this.pc);\n    } else {\n        this.getRemoteStreams = function () {\n            return [];\n        };\n    }\n\n    this.addStream = this.pc.addStream.bind(this.pc);\n\n    this.removeStream = function (stream) {\n        if (typeof self.pc.removeStream === 'function') {\n            self.pc.removeStream.apply(self.pc, arguments);\n        } else if (typeof self.pc.removeTrack === 'function') {\n            stream.getTracks().forEach(function (track) {\n                self.pc.removeTrack(track);\n            });\n        }\n    };\n\n    if (typeof this.pc.removeTrack === 'function') {\n        this.removeTrack = this.pc.removeTrack.bind(this.pc);\n    }\n\n    // proxy some events directly\n    this.pc.onremovestream = this.emit.bind(this, 'removeStream');\n    this.pc.onremovetrack = this.emit.bind(this, 'removeTrack');\n    this.pc.onaddstream = this.emit.bind(this, 'addStream');\n    this.pc.onnegotiationneeded = this.emit.bind(this, 'negotiationNeeded');\n    this.pc.oniceconnectionstatechange = this.emit.bind(this, 'iceConnectionStateChange');\n    this.pc.onsignalingstatechange = this.emit.bind(this, 'signalingStateChange');\n\n    // handle ice candidate and data channel events\n    this.pc.onicecandidate = this._onIce.bind(this);\n    this.pc.ondatachannel = this._onDataChannel.bind(this);\n\n    this.localDescription = {\n        contents: []\n    };\n    this.remoteDescription = {\n        contents: []\n    };\n\n    this.config = {\n        debug: false,\n        sid: '',\n        isInitiator: true,\n        sdpSessionID: Date.now(),\n        useJingle: false\n    };\n\n    this.iceCredentials = {\n        local: {},\n        remote: {}\n    };\n\n    // apply our config\n    for (item in config) {\n        this.config[item] = config[item];\n    }\n\n    if (this.config.debug) {\n        this.on('*', function () {\n            var logger = config.logger || console;\n            logger.log('PeerConnection event:', arguments);\n        });\n    }\n    this.hadLocalStunCandidate = false;\n    this.hadRemoteStunCandidate = false;\n    this.hadLocalRelayCandidate = false;\n    this.hadRemoteRelayCandidate = false;\n\n    this.hadLocalIPv6Candidate = false;\n    this.hadRemoteIPv6Candidate = false;\n\n    // keeping references for all our data channels\n    // so they dont get garbage collected\n    // can be removed once the following bugs have been fixed\n    // https://crbug.com/405545\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=964092\n    // to be filed for opera\n    this._remoteDataChannels = [];\n    this._localDataChannels = [];\n\n    this._candidateBuffer = [];\n}\n\nutil.inherits(PeerConnection, WildEmitter);\n\nObject.defineProperty(PeerConnection.prototype, 'signalingState', {\n    get: function () {\n        return this.pc.signalingState;\n    }\n});\nObject.defineProperty(PeerConnection.prototype, 'iceConnectionState', {\n    get: function () {\n        return this.pc.iceConnectionState;\n    }\n});\n\nPeerConnection.prototype._role = function () {\n    return this.isInitiator ? 'initiator' : 'responder';\n};\n\n// Add a stream to the peer connection object\nPeerConnection.prototype.addStream = function (stream) {\n    this.localStream = stream;\n    this.pc.addStream(stream);\n};\n\n// helper function to check if a remote candidate is a stun/relay\n// candidate or an ipv6 candidate\nPeerConnection.prototype._checkLocalCandidate = function (candidate) {\n    var cand = SJJ.toCandidateJSON(candidate);\n    if (cand.type == 'srflx') {\n        this.hadLocalStunCandidate = true;\n    } else if (cand.type == 'relay') {\n        this.hadLocalRelayCandidate = true;\n    }\n    if (cand.ip.indexOf(':') != -1) {\n        this.hadLocalIPv6Candidate = true;\n    }\n};\n\n// helper function to check if a remote candidate is a stun/relay\n// candidate or an ipv6 candidate\nPeerConnection.prototype._checkRemoteCandidate = function (candidate) {\n    var cand = SJJ.toCandidateJSON(candidate);\n    if (cand.type == 'srflx') {\n        this.hadRemoteStunCandidate = true;\n    } else if (cand.type == 'relay') {\n        this.hadRemoteRelayCandidate = true;\n    }\n    if (cand.ip.indexOf(':') != -1) {\n        this.hadRemoteIPv6Candidate = true;\n    }\n};\n\n\n// Init and add ice candidate object with correct constructor\nPeerConnection.prototype.processIce = function (update, cb) {\n    cb = cb || function () {};\n    var self = this;\n\n    // ignore any added ice candidates to avoid errors. why does the\n    // spec not do this?\n    if (this.pc.signalingState === 'closed') return cb();\n\n    if (update.contents || (update.jingle && update.jingle.contents)) {\n        var contentNames = this.remoteDescription.contents.map(function (c) { return c.name; });\n        var contents = update.contents || update.jingle.contents;\n\n        contents.forEach(function (content) {\n            var transport = content.transport || {};\n            var candidates = transport.candidates || [];\n            var mline = contentNames.indexOf(content.name);\n            var mid = content.name;\n            var remoteContent = self.remoteDescription.contents.find(function (c) {\n                return c.name === content.name;\n            });\n\n            // process candidates as a callback, in case we need to\n            // update ufrag and pwd with offer/answer\n            var processCandidates = function () {\n                candidates.forEach(\n                    function (candidate) {\n                    var iceCandidate = SJJ.toCandidateSDP(candidate);\n                    self.pc.addIceCandidate(\n                        new RTCIceCandidate({\n                            candidate: iceCandidate,\n                            sdpMLineIndex: mline,\n                            sdpMid: mid\n                        }), function () {\n                            // well, this success callback is pretty meaningless\n                        },\n                        function (err) {\n                            self.emit('error', err);\n                        }\n                    );\n                    self._checkRemoteCandidate(iceCandidate);\n                });\n                cb();\n            };\n\n            if (self.iceCredentials.remote[content.name] && transport.ufrag &&\n                self.iceCredentials.remote[content.name].ufrag !== transport.ufrag) {\n                if (remoteContent) {\n                    remoteContent.transport.ufrag = transport.ufrag;\n                    remoteContent.transport.pwd = transport.pwd;\n                    var offer = {\n                        type: 'offer',\n                        jingle: self.remoteDescription\n                    };\n                    offer.sdp = SJJ.toSessionSDP(offer.jingle, {\n                        sid: self.config.sdpSessionID,\n                        role: self._role(),\n                        direction: 'incoming'\n                    });\n                    self.pc.setRemoteDescription(new RTCSessionDescription(offer),\n                        function () {\n                            processCandidates();\n                        },\n                        function (err) {\n                            self.emit('error', err);\n                        }\n                    );\n                } else {\n                    self.emit('error', 'ice restart failed to find matching content');\n                }\n            } else {\n                processCandidates();\n            }\n        });\n    } else {\n        // working around https://code.google.com/p/webrtc/issues/detail?id=3669\n        if (update.candidate && update.candidate.candidate.indexOf('a=') !== 0) {\n            update.candidate.candidate = 'a=' + update.candidate.candidate;\n        }\n\n        if (this.wtFirefox && this.firefoxcandidatebuffer !== null) {\n            // we cant add this yet due to https://bugzilla.mozilla.org/show_bug.cgi?id=1087551\n            if (this.pc.localDescription && this.pc.localDescription.type === 'offer') {\n                this.firefoxcandidatebuffer.push(update.candidate);\n                return cb();\n            }\n        }\n\n        self.pc.addIceCandidate(\n            new RTCIceCandidate(update.candidate),\n            function () { },\n            function (err) {\n                self.emit('error', err);\n            }\n        );\n        self._checkRemoteCandidate(update.candidate.candidate);\n        cb();\n    }\n};\n\n// Generate and emit an offer with the given constraints\nPeerConnection.prototype.offer = function (constraints, cb) {\n    var self = this;\n    var hasConstraints = arguments.length === 2;\n    var mediaConstraints = hasConstraints && constraints ? constraints : {\n            offerToReceiveAudio: 1,\n            offerToReceiveVideo: 1\n        };\n    cb = hasConstraints ? cb : constraints;\n    cb = cb || function () {};\n\n    if (this.pc.signalingState === 'closed') return cb('Already closed');\n\n    // Actually generate the offer\n    this.pc.createOffer(\n        function (offer) {\n            // does not work for jingle, but jingle.js doesn't need\n            // this hack...\n            var expandedOffer = {\n                type: 'offer',\n                sdp: offer.sdp\n            };\n            if (self.assumeSetLocalSuccess) {\n                self.emit('offer', expandedOffer);\n                cb(null, expandedOffer);\n            }\n            self._candidateBuffer = [];\n            self.pc.setLocalDescription(offer,\n                function () {\n                    var jingle;\n                    if (self.config.useJingle) {\n                        jingle = SJJ.toSessionJSON(offer.sdp, {\n                            role: self._role(),\n                            direction: 'outgoing'\n                        });\n                        jingle.sid = self.config.sid;\n                        self.localDescription = jingle;\n\n                        // Save ICE credentials\n                        jingle.contents.forEach(function (content) {\n                            var transport = content.transport || {};\n                            if (transport.ufrag) {\n                                self.iceCredentials.local[content.name] = {\n                                    ufrag: transport.ufrag,\n                                    pwd: transport.pwd\n                                };\n                            }\n                        });\n\n                        expandedOffer.jingle = jingle;\n                    }\n                    expandedOffer.sdp.split('\\r\\n').forEach(function (line) {\n                        if (line.indexOf('a=candidate:') === 0) {\n                            self._checkLocalCandidate(line);\n                        }\n                    });\n\n                    if (!self.assumeSetLocalSuccess) {\n                        self.emit('offer', expandedOffer);\n                        cb(null, expandedOffer);\n                    }\n                },\n                function (err) {\n                    self.emit('error', err);\n                    cb(err);\n                }\n            );\n        },\n        function (err) {\n            self.emit('error', err);\n            cb(err);\n        },\n        mediaConstraints\n    );\n};\n\n\n// Process an incoming offer so that ICE may proceed before deciding\n// to answer the request.\nPeerConnection.prototype.handleOffer = function (offer, cb) {\n    cb = cb || function () {};\n    var self = this;\n    offer.type = 'offer';\n    if (offer.jingle) {\n        if (this.enableChromeNativeSimulcast) {\n            offer.jingle.contents.forEach(function (content) {\n                if (content.name === 'video') {\n                    content.application.googConferenceFlag = true;\n                }\n\n            });\n        }\n        if (this.enableMultiStreamHacks) {\n            // add a mixed video stream as first stream\n            offer.jingle.contents.forEach(function (content) {\n                if (content.name === 'video') {\n                    var sources = content.application.sources || [];\n                    if (sources.length === 0 || sources[0].ssrc !== \"3735928559\") {\n                        sources.unshift({\n                            ssrc: \"3735928559\", // 0xdeadbeef\n                            parameters: [\n                                {\n                                    key: \"cname\",\n                                    value: \"deadbeef\"\n                                },\n                                {\n                                    key: \"msid\",\n                                    value: \"mixyourfecintothis please\"\n                                }\n                            ]\n                        });\n                        content.application.sources = sources;\n                    }\n                }\n            });\n        }\n        if (self.restrictBandwidth > 0) {\n            if (offer.jingle.contents.length >= 2 && offer.jingle.contents[1].name === 'video') {\n                var content = offer.jingle.contents[1];\n                var hasBw = content.application && content.application.bandwidth && content.application.bandwidth.bandwidth;\n                if (!hasBw) {\n                    offer.jingle.contents[1].application.bandwidth = { type: 'AS', bandwidth: self.restrictBandwidth.toString() };\n                    offer.sdp = SJJ.toSessionSDP(offer.jingle, {\n                        sid: self.config.sdpSessionID,\n                        role: self._role(),\n                        direction: 'outgoing'\n                    });\n                }\n            }\n        }\n        // Save ICE credentials\n        offer.jingle.contents.forEach(function (content) {\n            var transport = content.transport || {};\n            if (transport.ufrag) {\n                self.iceCredentials.remote[content.name] = {\n                    ufrag: transport.ufrag,\n                    pwd: transport.pwd\n                };\n            }\n        });\n        offer.sdp = SJJ.toSessionSDP(offer.jingle, {\n            sid: self.config.sdpSessionID,\n            role: self._role(),\n            direction: 'incoming'\n        });\n        self.remoteDescription = offer.jingle;\n    }\n    offer.sdp.split('\\r\\n').forEach(function (line) {\n        if (line.indexOf('a=candidate:') === 0) {\n            self._checkRemoteCandidate(line);\n        }\n    });\n    self.pc.setRemoteDescription(new RTCSessionDescription(offer),\n        function () {\n            cb();\n        },\n        cb\n    );\n};\n\n// Answer an offer with audio only\nPeerConnection.prototype.answerAudioOnly = function (cb) {\n    var mediaConstraints = {\n            mandatory: {\n                OfferToReceiveAudio: true,\n                OfferToReceiveVideo: false\n            }\n        };\n    this._answer(mediaConstraints, cb);\n};\n\n// Answer an offer without offering to recieve\nPeerConnection.prototype.answerBroadcastOnly = function (cb) {\n    var mediaConstraints = {\n            mandatory: {\n                OfferToReceiveAudio: false,\n                OfferToReceiveVideo: false\n            }\n        };\n    this._answer(mediaConstraints, cb);\n};\n\n// Answer an offer with given constraints default is audio/video\nPeerConnection.prototype.answer = function (constraints, cb) {\n    var hasConstraints = arguments.length === 2;\n    var callback = hasConstraints ? cb : constraints;\n    var mediaConstraints = hasConstraints && constraints ? constraints : {\n            mandatory: {\n                OfferToReceiveAudio: true,\n                OfferToReceiveVideo: true\n            }\n        };\n\n    this._answer(mediaConstraints, callback);\n};\n\n// Process an answer\nPeerConnection.prototype.handleAnswer = function (answer, cb) {\n    cb = cb || function () {};\n    var self = this;\n    if (answer.jingle) {\n        answer.sdp = SJJ.toSessionSDP(answer.jingle, {\n            sid: self.config.sdpSessionID,\n            role: self._role(),\n            direction: 'incoming'\n        });\n        self.remoteDescription = answer.jingle;\n\n        // Save ICE credentials\n        answer.jingle.contents.forEach(function (content) {\n            var transport = content.transport || {};\n            if (transport.ufrag) {\n                self.iceCredentials.remote[content.name] = {\n                    ufrag: transport.ufrag,\n                    pwd: transport.pwd\n                };\n            }\n        });\n    }\n    answer.sdp.split('\\r\\n').forEach(function (line) {\n        if (line.indexOf('a=candidate:') === 0) {\n            self._checkRemoteCandidate(line);\n        }\n    });\n    self.pc.setRemoteDescription(\n        new RTCSessionDescription(answer),\n        function () {\n            if (self.wtFirefox) {\n                window.setTimeout(function () {\n                    self.firefoxcandidatebuffer.forEach(function (candidate) {\n                        // add candidates later\n                        self.pc.addIceCandidate(\n                            new RTCIceCandidate(candidate),\n                            function () { },\n                            function (err) {\n                                self.emit('error', err);\n                            }\n                        );\n                        self._checkRemoteCandidate(candidate.candidate);\n                    });\n                    self.firefoxcandidatebuffer = null;\n                }, self.wtFirefox);\n            }\n            cb(null);\n        },\n        cb\n    );\n};\n\n// Close the peer connection\nPeerConnection.prototype.close = function () {\n    this.pc.close();\n\n    this._localDataChannels = [];\n    this._remoteDataChannels = [];\n\n    this.emit('close');\n};\n\n// Internal code sharing for various types of answer methods\nPeerConnection.prototype._answer = function (constraints, cb) {\n    cb = cb || function () {};\n    var self = this;\n    if (!this.pc.remoteDescription) {\n        // the old API is used, call handleOffer\n        throw new Error('remoteDescription not set');\n    }\n\n    if (this.pc.signalingState === 'closed') return cb('Already closed');\n\n    self.pc.createAnswer(\n        function (answer) {\n            var sim = [];\n            if (self.enableChromeNativeSimulcast) {\n                // native simulcast part 1: add another SSRC\n                answer.jingle = SJJ.toSessionJSON(answer.sdp, {\n                    role: self._role(),\n                    direction: 'outgoing'\n                });\n                if (answer.jingle.contents.length >= 2 && answer.jingle.contents[1].name === 'video') {\n                    var groups = answer.jingle.contents[1].application.sourceGroups || [];\n                    var hasSim = false;\n                    groups.forEach(function (group) {\n                        if (group.semantics == 'SIM') hasSim = true;\n                    });\n                    if (!hasSim &&\n                        answer.jingle.contents[1].application.sources.length) {\n                        var newssrc = JSON.parse(JSON.stringify(answer.jingle.contents[1].application.sources[0]));\n                        newssrc.ssrc = '' + Math.floor(Math.random() * 0xffffffff); // FIXME: look for conflicts\n                        answer.jingle.contents[1].application.sources.push(newssrc);\n\n                        sim.push(answer.jingle.contents[1].application.sources[0].ssrc);\n                        sim.push(newssrc.ssrc);\n                        groups.push({\n                            semantics: 'SIM',\n                            sources: sim\n                        });\n\n                        // also create an RTX one for the SIM one\n                        var rtxssrc = JSON.parse(JSON.stringify(newssrc));\n                        rtxssrc.ssrc = '' + Math.floor(Math.random() * 0xffffffff); // FIXME: look for conflicts\n                        answer.jingle.contents[1].application.sources.push(rtxssrc);\n                        groups.push({\n                            semantics: 'FID',\n                            sources: [newssrc.ssrc, rtxssrc.ssrc]\n                        });\n\n                        answer.jingle.contents[1].application.sourceGroups = groups;\n                        answer.sdp = SJJ.toSessionSDP(answer.jingle, {\n                            sid: self.config.sdpSessionID,\n                            role: self._role(),\n                            direction: 'outgoing'\n                        });\n                    }\n                }\n            }\n            var expandedAnswer = {\n                type: 'answer',\n                sdp: answer.sdp\n            };\n            if (self.assumeSetLocalSuccess) {\n                // not safe to do when doing simulcast mangling\n                var copy = cloneDeep(expandedAnswer);\n                self.emit('answer', copy);\n                cb(null, copy);\n            }\n            self._candidateBuffer = [];\n            self.pc.setLocalDescription(answer,\n                function () {\n                    if (self.config.useJingle) {\n                        var jingle = SJJ.toSessionJSON(answer.sdp, {\n                            role: self._role(),\n                            direction: 'outgoing'\n                        });\n                        jingle.sid = self.config.sid;\n                        self.localDescription = jingle;\n                        expandedAnswer.jingle = jingle;\n                    }\n                    if (self.enableChromeNativeSimulcast) {\n                        // native simulcast part 2:\n                        // signal multiple tracks to the receiver\n                        // for anything in the SIM group\n                        if (!expandedAnswer.jingle) {\n                            expandedAnswer.jingle = SJJ.toSessionJSON(answer.sdp, {\n                                role: self._role(),\n                                direction: 'outgoing'\n                            });\n                        }\n                        expandedAnswer.jingle.contents[1].application.sources.forEach(function (source, idx) {\n                            // the floor idx/2 is a hack that relies on a particular order\n                            // of groups, alternating between sim and rtx\n                            source.parameters = source.parameters.map(function (parameter) {\n                                if (parameter.key === 'msid') {\n                                    parameter.value += '-' + Math.floor(idx / 2);\n                                }\n                                return parameter;\n                            });\n                        });\n                        expandedAnswer.sdp = SJJ.toSessionSDP(expandedAnswer.jingle, {\n                            sid: self.sdpSessionID,\n                            role: self._role(),\n                            direction: 'outgoing'\n                        });\n                    }\n                    expandedAnswer.sdp.split('\\r\\n').forEach(function (line) {\n                        if (line.indexOf('a=candidate:') === 0) {\n                            self._checkLocalCandidate(line);\n                        }\n                    });\n                    if (!self.assumeSetLocalSuccess) {\n                        var copy = cloneDeep(expandedAnswer);\n                        self.emit('answer', copy);\n                        cb(null, copy);\n                    }\n                },\n                function (err) {\n                    self.emit('error', err);\n                    cb(err);\n                }\n            );\n        },\n        function (err) {\n            self.emit('error', err);\n            cb(err);\n        },\n        constraints\n    );\n};\n\n// Internal method for emitting ice candidates on our peer object\nPeerConnection.prototype._onIce = function (event) {\n    var self = this;\n    if (event.candidate) {\n        if (this.dontSignalCandidates) return;\n        var ice = event.candidate;\n\n        var expandedCandidate = {\n            candidate: {\n                candidate: ice.candidate,\n                sdpMid: ice.sdpMid,\n                sdpMLineIndex: ice.sdpMLineIndex\n            }\n        };\n        this._checkLocalCandidate(ice.candidate);\n\n        var cand = SJJ.toCandidateJSON(ice.candidate);\n\n        var already;\n        var idx;\n        if (this.eliminateDuplicateCandidates && cand.type === 'relay') {\n            // drop candidates with same foundation, component\n            // take local type pref into account so we don't ignore udp\n            // ones when we know about a TCP one. unlikely but...\n            already = this._candidateBuffer.filter(\n                function (c) {\n                    return c.type === 'relay';\n                }).map(function (c) {\n                    return c.foundation + ':' + c.component;\n                }\n            );\n            idx = already.indexOf(cand.foundation + ':' + cand.component);\n            // remember: local type pref of udp is 0, tcp 1, tls 2\n            if (idx > -1 && ((cand.priority >> 24) >= (already[idx].priority >> 24))) {\n                // drop it, same foundation with higher (worse) type pref\n                return;\n            }\n        }\n        if (this.config.bundlePolicy === 'max-bundle') {\n            // drop candidates which are duplicate for audio/video/data\n            // duplicate means same host/port but different sdpMid\n            already = this._candidateBuffer.filter(\n                function (c) {\n                    return cand.type === c.type;\n                }).map(function (cand) {\n                    return cand.address + ':' + cand.port;\n                }\n            );\n            idx = already.indexOf(cand.address + ':' + cand.port);\n            if (idx > -1) return;\n        }\n        // also drop rtcp candidates since we know the peer supports RTCP-MUX\n        // this is a workaround until browsers implement this natively\n        if (this.config.rtcpMuxPolicy === 'require' && cand.component === '2') {\n            return;\n        }\n        this._candidateBuffer.push(cand);\n\n        if (self.config.useJingle) {\n            if (!ice.sdpMid) { // firefox doesn't set this\n                if (self.pc.remoteDescription && self.pc.remoteDescription.type === 'offer') {\n                    // preserve name from remote\n                    ice.sdpMid = self.remoteDescription.contents[ice.sdpMLineIndex].name;\n                } else {\n                    ice.sdpMid = self.localDescription.contents[ice.sdpMLineIndex].name;\n                }\n            }\n            if (!self.iceCredentials.local[ice.sdpMid]) {\n                var jingle = SJJ.toSessionJSON(self.pc.localDescription.sdp, {\n                    role: self._role(),\n                    direction: 'outgoing'\n                });\n                jingle.contents.forEach(function (content) {\n                    var transport = content.transport || {};\n                    if (transport.ufrag) {\n                        self.iceCredentials.local[content.name] = {\n                            ufrag: transport.ufrag,\n                            pwd: transport.pwd\n                        };\n                    }\n                });\n            }\n            expandedCandidate.jingle = {\n                contents: [{\n                    name: ice.sdpMid,\n                    creator: self._role(),\n                    transport: {\n                        transportType: 'iceUdp',\n                        ufrag: self.iceCredentials.local[ice.sdpMid].ufrag,\n                        pwd: self.iceCredentials.local[ice.sdpMid].pwd,\n                        candidates: [\n                            cand\n                        ]\n                    }\n                }]\n            };\n            if (self.batchIceCandidates > 0) {\n                if (self.batchedIceCandidates.length === 0) {\n                    window.setTimeout(function () {\n                        var contents = {};\n                        self.batchedIceCandidates.forEach(function (content) {\n                            content = content.contents[0];\n                            if (!contents[content.name]) contents[content.name] = content;\n                            contents[content.name].transport.candidates.push(content.transport.candidates[0]);\n                        });\n                        var newCand = {\n                            jingle: {\n                                contents: []\n                            }\n                        };\n                        Object.keys(contents).forEach(function (name) {\n                            newCand.jingle.contents.push(contents[name]);\n                        });\n                        self.batchedIceCandidates = [];\n                        self.emit('ice', newCand);\n                    }, self.batchIceCandidates);\n                }\n                self.batchedIceCandidates.push(expandedCandidate.jingle);\n                return;\n            }\n\n        }\n        this.emit('ice', expandedCandidate);\n    } else {\n        this.emit('endOfCandidates');\n    }\n};\n\n// Internal method for processing a new data channel being added by the\n// other peer.\nPeerConnection.prototype._onDataChannel = function (event) {\n    // make sure we keep a reference so this doesn't get garbage collected\n    var channel = event.channel;\n    this._remoteDataChannels.push(channel);\n\n    this.emit('addChannel', channel);\n};\n\n// Create a data channel spec reference:\n// http://dev.w3.org/2011/webrtc/editor/webrtc.html#idl-def-RTCDataChannelInit\nPeerConnection.prototype.createDataChannel = function (name, opts) {\n    var channel = this.pc.createDataChannel(name, opts);\n\n    // make sure we keep a reference so this doesn't get garbage collected\n    this._localDataChannels.push(channel);\n\n    return channel;\n};\n\nPeerConnection.prototype.getStats = function () {\n    if (typeof arguments[0] === 'function') {\n        var cb = arguments[0];\n        this.pc.getStats().then(function (res) {\n            cb(null, res);\n        }, function (err) {\n            cb(err);\n        });\n    } else {\n        return this.pc.getStats.apply(this.pc, arguments);\n    }\n};\n\nmodule.exports = PeerConnection;\n","var toSDP = require('./lib/tosdp');\nvar toJSON = require('./lib/tojson');\n\n\n// Converstion from JSON to SDP\n\nexports.toIncomingSDPOffer = function (session) {\n    return toSDP.toSessionSDP(session, {\n        role: 'responder',\n        direction: 'incoming'\n    });\n};\nexports.toOutgoingSDPOffer = function (session) {\n    return toSDP.toSessionSDP(session, {\n        role: 'initiator',\n        direction: 'outgoing'\n    });\n};\nexports.toIncomingSDPAnswer = function (session) {\n    return toSDP.toSessionSDP(session, {\n        role: 'initiator',\n        direction: 'incoming'\n    });\n};\nexports.toOutgoingSDPAnswer = function (session) {\n    return toSDP.toSessionSDP(session, {\n        role: 'responder',\n        direction: 'outgoing'\n    });\n};\nexports.toIncomingMediaSDPOffer = function (media) {\n    return toSDP.toMediaSDP(media, {\n        role: 'responder',\n        direction: 'incoming'\n    });\n};\nexports.toOutgoingMediaSDPOffer = function (media) {\n    return toSDP.toMediaSDP(media, {\n        role: 'initiator',\n        direction: 'outgoing'\n    });\n};\nexports.toIncomingMediaSDPAnswer = function (media) {\n    return toSDP.toMediaSDP(media, {\n        role: 'initiator',\n        direction: 'incoming'\n    });\n};\nexports.toOutgoingMediaSDPAnswer = function (media) {\n    return toSDP.toMediaSDP(media, {\n        role: 'responder',\n        direction: 'outgoing'\n    });\n};\nexports.toCandidateSDP = toSDP.toCandidateSDP;\nexports.toMediaSDP = toSDP.toMediaSDP;\nexports.toSessionSDP = toSDP.toSessionSDP;\n\n\n// Conversion from SDP to JSON\n\nexports.toIncomingJSONOffer = function (sdp, creators) {\n    return toJSON.toSessionJSON(sdp, {\n        role: 'responder',\n        direction: 'incoming',\n        creators: creators\n    });\n};\nexports.toOutgoingJSONOffer = function (sdp, creators) {\n    return toJSON.toSessionJSON(sdp, {\n        role: 'initiator',\n        direction: 'outgoing',\n        creators: creators\n    });\n};\nexports.toIncomingJSONAnswer = function (sdp, creators) {\n    return toJSON.toSessionJSON(sdp, {\n        role: 'initiator',\n        direction: 'incoming',\n        creators: creators\n    });\n};\nexports.toOutgoingJSONAnswer = function (sdp, creators) {\n    return toJSON.toSessionJSON(sdp, {\n        role: 'responder',\n        direction: 'outgoing',\n        creators: creators\n    });\n};\nexports.toIncomingMediaJSONOffer = function (sdp, creator) {\n    return toJSON.toMediaJSON(sdp, {\n        role: 'responder',\n        direction: 'incoming',\n        creator: creator\n    });\n};\nexports.toOutgoingMediaJSONOffer = function (sdp, creator) {\n    return toJSON.toMediaJSON(sdp, {\n        role: 'initiator',\n        direction: 'outgoing',\n        creator: creator\n    });\n};\nexports.toIncomingMediaJSONAnswer = function (sdp, creator) {\n    return toJSON.toMediaJSON(sdp, {\n        role: 'initiator',\n        direction: 'incoming',\n        creator: creator\n    });\n};\nexports.toOutgoingMediaJSONAnswer = function (sdp, creator) {\n    return toJSON.toMediaJSON(sdp, {\n        role: 'responder',\n        direction: 'outgoing',\n        creator: creator\n    });\n};\nexports.toCandidateJSON = toJSON.toCandidateJSON;\nexports.toMediaJSON = toJSON.toMediaJSON;\nexports.toSessionJSON = toJSON.toSessionJSON;\n","exports.lines = function (sdp) {\n    return sdp.split(/\\r?\\n/).filter(function (line) {\n        return line.length > 0;\n    });\n};\n\nexports.findLine = function (prefix, mediaLines, sessionLines) {\n    var prefixLength = prefix.length;\n    for (var i = 0; i < mediaLines.length; i++) {\n        if (mediaLines[i].substr(0, prefixLength) === prefix) {\n            return mediaLines[i];\n        }\n    }\n    // Continue searching in parent session section\n    if (!sessionLines) {\n        return false;\n    }\n\n    for (var j = 0; j < sessionLines.length; j++) {\n        if (sessionLines[j].substr(0, prefixLength) === prefix) {\n            return sessionLines[j];\n        }\n    }\n\n    return false;\n};\n\nexports.findLines = function (prefix, mediaLines, sessionLines) {\n    var results = [];\n    var prefixLength = prefix.length;\n    for (var i = 0; i < mediaLines.length; i++) {\n        if (mediaLines[i].substr(0, prefixLength) === prefix) {\n            results.push(mediaLines[i]);\n        }\n    }\n    if (results.length || !sessionLines) {\n        return results;\n    }\n    for (var j = 0; j < sessionLines.length; j++) {\n        if (sessionLines[j].substr(0, prefixLength) === prefix) {\n            results.push(sessionLines[j]);\n        }\n    }\n    return results;\n};\n\nexports.mline = function (line) {\n    var parts = line.substr(2).split(' ');\n    var parsed = {\n        media: parts[0],\n        port: parts[1],\n        proto: parts[2],\n        formats: []\n    };\n    for (var i = 3; i < parts.length; i++) {\n        if (parts[i]) {\n            parsed.formats.push(parts[i]);\n        }\n    }\n    return parsed;\n};\n\nexports.rtpmap = function (line) {\n    var parts = line.substr(9).split(' ');\n    var parsed = {\n        id: parts.shift()\n    };\n\n    parts = parts[0].split('/');\n\n    parsed.name = parts[0];\n    parsed.clockrate = parts[1];\n    parsed.channels = parts.length == 3 ? parts[2] : '1';\n    return parsed;\n};\n\nexports.sctpmap = function (line) {\n    // based on -05 draft\n    var parts = line.substr(10).split(' ');\n    var parsed = {\n        number: parts.shift(),\n        protocol: parts.shift(),\n        streams: parts.shift()\n    };\n    return parsed;\n};\n\n\nexports.fmtp = function (line) {\n    var kv, key, value;\n    var parts = line.substr(line.indexOf(' ') + 1).split(';');\n    var parsed = [];\n    for (var i = 0; i < parts.length; i++) {\n        kv = parts[i].split('=');\n        key = kv[0].trim();\n        value = kv[1];\n        if (key && value) {\n            parsed.push({key: key, value: value});\n        } else if (key) {\n            parsed.push({key: '', value: key});\n        }\n    }\n    return parsed;\n};\n\nexports.crypto = function (line) {\n    var parts = line.substr(9).split(' ');\n    var parsed = {\n        tag: parts[0],\n        cipherSuite: parts[1],\n        keyParams: parts[2],\n        sessionParams: parts.slice(3).join(' ')\n    };\n    return parsed;\n};\n\nexports.fingerprint = function (line) {\n    var parts = line.substr(14).split(' ');\n    return {\n        hash: parts[0],\n        value: parts[1]\n    };\n};\n\nexports.extmap = function (line) {\n    var parts = line.substr(9).split(' ');\n    var parsed = {};\n\n    var idpart = parts.shift();\n    var sp = idpart.indexOf('/');\n    if (sp >= 0) {\n        parsed.id = idpart.substr(0, sp);\n        parsed.senders = idpart.substr(sp + 1);\n    } else {\n        parsed.id = idpart;\n        parsed.senders = 'sendrecv';\n    }\n\n    parsed.uri = parts.shift() || '';\n\n    return parsed;\n};\n\nexports.rtcpfb = function (line) {\n    var parts = line.substr(10).split(' ');\n    var parsed = {};\n    parsed.id = parts.shift();\n    parsed.type = parts.shift();\n    if (parsed.type === 'trr-int') {\n        parsed.value = parts.shift();\n    } else {\n        parsed.subtype = parts.shift() || '';\n    }\n    parsed.parameters = parts;\n    return parsed;\n};\n\nexports.candidate = function (line) {\n    var parts;\n    if (line.indexOf('a=candidate:') === 0) {\n        parts = line.substring(12).split(' ');\n    } else { // no a=candidate\n        parts = line.substring(10).split(' ');\n    }\n\n    var candidate = {\n        foundation: parts[0],\n        component: parts[1],\n        protocol: parts[2].toLowerCase(),\n        priority: parts[3],\n        ip: parts[4],\n        port: parts[5],\n        // skip parts[6] == 'typ'\n        type: parts[7],\n        generation: '0'\n    };\n\n    for (var i = 8; i < parts.length; i += 2) {\n        if (parts[i] === 'raddr') {\n            candidate.relAddr = parts[i + 1];\n        } else if (parts[i] === 'rport') {\n            candidate.relPort = parts[i + 1];\n        } else if (parts[i] === 'generation') {\n            candidate.generation = parts[i + 1];\n        } else if (parts[i] === 'tcptype') {\n            candidate.tcpType = parts[i + 1];\n        }\n    }\n\n    candidate.network = '1';\n\n    return candidate;\n};\n\nexports.sourceGroups = function (lines) {\n    var parsed = [];\n    for (var i = 0; i < lines.length; i++) {\n        var parts = lines[i].substr(13).split(' ');\n        parsed.push({\n            semantics: parts.shift(),\n            sources: parts\n        });\n    }\n    return parsed;\n};\n\nexports.sources = function (lines) {\n    // http://tools.ietf.org/html/rfc5576\n    var parsed = [];\n    var sources = {};\n    for (var i = 0; i < lines.length; i++) {\n        var parts = lines[i].substr(7).split(' ');\n        var ssrc = parts.shift();\n\n        if (!sources[ssrc]) {\n            var source = {\n                ssrc: ssrc,\n                parameters: []\n            };\n            parsed.push(source);\n\n            // Keep an index\n            sources[ssrc] = source;\n        }\n\n        parts = parts.join(' ').split(':');\n        var attribute = parts.shift();\n        var value = parts.join(':') || null;\n\n        sources[ssrc].parameters.push({\n            key: attribute,\n            value: value\n        });\n    }\n\n    return parsed;\n};\n\nexports.groups = function (lines) {\n    // http://tools.ietf.org/html/rfc5888\n    var parsed = [];\n    var parts;\n    for (var i = 0; i < lines.length; i++) {\n        parts = lines[i].substr(8).split(' ');\n        parsed.push({\n            semantics: parts.shift(),\n            contents: parts\n        });\n    }\n    return parsed;\n};\n\nexports.bandwidth = function (line) {\n    var parts = line.substr(2).split(':');\n    var parsed = {};\n    parsed.type = parts.shift();\n    parsed.bandwidth = parts.shift();\n    return parsed;\n};\n\nexports.msid = function (line) {\n    var data = line.substr(7);\n    var parts = data.split(' ');\n    return {\n        msid: data,\n        mslabel: parts[0],\n        label: parts[1]\n    };\n};\n","module.exports = {\n    initiator: {\n        incoming: {\n            initiator: 'recvonly',\n            responder: 'sendonly',\n            both: 'sendrecv',\n            none: 'inactive',\n            recvonly: 'initiator',\n            sendonly: 'responder',\n            sendrecv: 'both',\n            inactive: 'none'\n        },\n        outgoing: {\n            initiator: 'sendonly',\n            responder: 'recvonly',\n            both: 'sendrecv',\n            none: 'inactive',\n            recvonly: 'responder',\n            sendonly: 'initiator',\n            sendrecv: 'both',\n            inactive: 'none'\n        }\n    },\n    responder: {\n        incoming: {\n            initiator: 'sendonly',\n            responder: 'recvonly',\n            both: 'sendrecv',\n            none: 'inactive',\n            recvonly: 'responder',\n            sendonly: 'initiator',\n            sendrecv: 'both',\n            inactive: 'none'\n        },\n        outgoing: {\n            initiator: 'recvonly',\n            responder: 'sendonly',\n            both: 'sendrecv',\n            none: 'inactive',\n            recvonly: 'initiator',\n            sendonly: 'responder',\n            sendrecv: 'both',\n            inactive: 'none'\n        }\n    }\n};\n","var SENDERS = require('./senders');\nvar parsers = require('./parsers');\nvar idCounter = Math.random();\n\n\nexports._setIdCounter = function (counter) {\n    idCounter = counter;\n};\n\nexports.toSessionJSON = function (sdp, opts) {\n    var i;\n    var creators = opts.creators || [];\n    var role = opts.role || 'initiator';\n    var direction = opts.direction || 'outgoing';\n\n\n    // Divide the SDP into session and media sections.\n    var media = sdp.split(/\\r?\\nm=/);\n    for (i = 1; i < media.length; i++) {\n        media[i] = 'm=' + media[i];\n        if (i !== media.length - 1) {\n            media[i] += '\\r\\n';\n        }\n    }\n    var session = media.shift() + '\\r\\n';\n    var sessionLines = parsers.lines(session);\n    var parsed = {};\n\n    var contents = [];\n    for (i = 0; i < media.length; i++) {\n        contents.push(exports.toMediaJSON(media[i], session, {\n            role: role,\n            direction: direction,\n            creator: creators[i] || 'initiator'\n        }));\n    }\n    parsed.contents = contents;\n\n    var groupLines = parsers.findLines('a=group:', sessionLines);\n    if (groupLines.length) {\n        parsed.groups = parsers.groups(groupLines);\n    }\n\n    return parsed;\n};\n\nexports.toMediaJSON = function (media, session, opts) {\n    var creator = opts.creator || 'initiator';\n    var role = opts.role || 'initiator';\n    var direction = opts.direction || 'outgoing';\n\n    var lines = parsers.lines(media);\n    var sessionLines = parsers.lines(session);\n    var mline = parsers.mline(lines[0]);\n\n    var content = {\n        creator: creator,\n        name: mline.media,\n        application: {\n            applicationType: 'rtp',\n            media: mline.media,\n            payloads: [],\n            encryption: [],\n            feedback: [],\n            headerExtensions: []\n        },\n        transport: {\n            transportType: 'iceUdp',\n            candidates: [],\n            fingerprints: []\n        }\n    };\n    if (mline.media == 'application') {\n        // FIXME: the description is most likely to be independent\n        // of the SDP and should be processed by other parts of the library\n        content.application = {\n            applicationType: 'datachannel'\n        };\n        content.transport.sctp = [];\n    }\n    var desc = content.application;\n    var trans = content.transport;\n\n    // If we have a mid, use that for the content name instead.\n    var mid = parsers.findLine('a=mid:', lines);\n    if (mid) {\n        content.name = mid.substr(6);\n    }\n\n    if (parsers.findLine('a=sendrecv', lines, sessionLines)) {\n        content.senders = 'both';\n    } else if (parsers.findLine('a=sendonly', lines, sessionLines)) {\n        content.senders = SENDERS[role][direction].sendonly;\n    } else if (parsers.findLine('a=recvonly', lines, sessionLines)) {\n        content.senders = SENDERS[role][direction].recvonly;\n    } else if (parsers.findLine('a=inactive', lines, sessionLines)) {\n        content.senders = 'none';\n    }\n\n    if (desc.applicationType == 'rtp') {\n        var bandwidth = parsers.findLine('b=', lines);\n        if (bandwidth) {\n            desc.bandwidth = parsers.bandwidth(bandwidth);\n        }\n\n        var ssrc = parsers.findLine('a=ssrc:', lines);\n        if (ssrc) {\n            desc.ssrc = ssrc.substr(7).split(' ')[0];\n        }\n\n        var rtpmapLines = parsers.findLines('a=rtpmap:', lines);\n        rtpmapLines.forEach(function (line) {\n            var payload = parsers.rtpmap(line);\n            payload.parameters = [];\n            payload.feedback = [];\n\n            var fmtpLines = parsers.findLines('a=fmtp:' + payload.id, lines);\n            // There should only be one fmtp line per payload\n            fmtpLines.forEach(function (line) {\n                payload.parameters = parsers.fmtp(line);\n            });\n\n            var fbLines = parsers.findLines('a=rtcp-fb:' + payload.id, lines);\n            fbLines.forEach(function (line) {\n                payload.feedback.push(parsers.rtcpfb(line));\n            });\n\n            desc.payloads.push(payload);\n        });\n\n        var cryptoLines = parsers.findLines('a=crypto:', lines, sessionLines);\n        cryptoLines.forEach(function (line) {\n            desc.encryption.push(parsers.crypto(line));\n        });\n\n        if (parsers.findLine('a=rtcp-mux', lines)) {\n            desc.mux = true;\n        }\n\n        var fbLines = parsers.findLines('a=rtcp-fb:*', lines);\n        fbLines.forEach(function (line) {\n            desc.feedback.push(parsers.rtcpfb(line));\n        });\n\n        var extLines = parsers.findLines('a=extmap:', lines);\n        extLines.forEach(function (line) {\n            var ext = parsers.extmap(line);\n\n            ext.senders = SENDERS[role][direction][ext.senders];\n\n            desc.headerExtensions.push(ext);\n        });\n\n        var ssrcGroupLines = parsers.findLines('a=ssrc-group:', lines);\n        desc.sourceGroups = parsers.sourceGroups(ssrcGroupLines || []);\n\n        var ssrcLines = parsers.findLines('a=ssrc:', lines);\n        var sources = desc.sources = parsers.sources(ssrcLines || []);\n\n        var msidLine = parsers.findLine('a=msid:', lines);\n        if (msidLine) {\n            var msid = parsers.msid(msidLine);\n            ['msid', 'mslabel', 'label'].forEach(function (key) {\n                for (var i = 0; i < sources.length; i++) {\n                    var found = false;\n                    for (var j = 0; j < sources[i].parameters.length; j++) {\n                        if (sources[i].parameters[j].key === key) {\n                            found = true;\n                        }\n                    }\n                    if (!found) {\n                        sources[i].parameters.push({ key: key, value: msid[key] });\n                    }\n                }\n            });\n        }\n\n        if (parsers.findLine('a=x-google-flag:conference', lines, sessionLines)) {\n            desc.googConferenceFlag = true;\n        }\n    }\n\n    // transport specific attributes\n    var fingerprintLines = parsers.findLines('a=fingerprint:', lines, sessionLines);\n    var setup = parsers.findLine('a=setup:', lines, sessionLines);\n    fingerprintLines.forEach(function (line) {\n        var fp = parsers.fingerprint(line);\n        if (setup) {\n            fp.setup = setup.substr(8);\n        }\n        trans.fingerprints.push(fp);\n    });\n\n    var ufragLine = parsers.findLine('a=ice-ufrag:', lines, sessionLines);\n    var pwdLine = parsers.findLine('a=ice-pwd:', lines, sessionLines);\n    if (ufragLine && pwdLine) {\n        trans.ufrag = ufragLine.substr(12);\n        trans.pwd = pwdLine.substr(10);\n        trans.candidates = [];\n\n        var candidateLines = parsers.findLines('a=candidate:', lines, sessionLines);\n        candidateLines.forEach(function (line) {\n            trans.candidates.push(exports.toCandidateJSON(line));\n        });\n    }\n\n    if (desc.applicationType == 'datachannel') {\n        var sctpmapLines = parsers.findLines('a=sctpmap:', lines);\n        sctpmapLines.forEach(function (line) {\n            var sctp = parsers.sctpmap(line);\n            trans.sctp.push(sctp);\n        });\n    }\n\n    return content;\n};\n\nexports.toCandidateJSON = function (line) {\n    var candidate = parsers.candidate(line.split(/\\r?\\n/)[0]);\n    candidate.id = (idCounter++).toString(36).substr(0, 12);\n    return candidate;\n};\n","var SENDERS = require('./senders');\n\n\nexports.toSessionSDP = function (session, opts) {\n    var role = opts.role || 'initiator';\n    var direction = opts.direction || 'outgoing';\n    var sid = opts.sid || session.sid || Date.now();\n    var time = opts.time || Date.now();\n\n    var sdp = [\n        'v=0',\n        'o=- ' + sid + ' ' + time + ' IN IP4 0.0.0.0',\n        's=-',\n        't=0 0'\n    ];\n\n    var contents = session.contents || [];\n    var hasSources = false;\n    contents.forEach(function (content) {\n        if (content.application.sources &&\n            content.application.sources.length) {\n            hasSources = true;\n        }\n    });\n\n    if (hasSources) {\n        sdp.push('a=msid-semantic: WMS *');\n    }\n\n    var groups = session.groups || [];\n    groups.forEach(function (group) {\n        sdp.push('a=group:' + group.semantics + ' ' + group.contents.join(' '));\n    });\n\n\n    contents.forEach(function (content) {\n        sdp.push(exports.toMediaSDP(content, opts));\n    });\n\n    return sdp.join('\\r\\n') + '\\r\\n';\n};\n\nexports.toMediaSDP = function (content, opts) {\n    var sdp = [];\n\n    var role = opts.role || 'initiator';\n    var direction = opts.direction || 'outgoing';\n\n    var desc = content.application;\n    var transport = content.transport;\n    var payloads = desc.payloads || [];\n    var fingerprints = (transport && transport.fingerprints) || [];\n\n    var mline = [];\n    if (desc.applicationType == 'datachannel') {\n        mline.push('application');\n        mline.push('1');\n        mline.push('DTLS/SCTP');\n        if (transport.sctp) {\n            transport.sctp.forEach(function (map) {\n                mline.push(map.number);\n            });\n        }\n    } else {\n        mline.push(desc.media);\n        mline.push('1');\n        if (fingerprints.length > 0) {\n            mline.push('UDP/TLS/RTP/SAVPF');\n        } else if (desc.encryption && desc.encryption.length > 0) {\n            mline.push('RTP/SAVPF');\n        } else {\n            mline.push('RTP/AVPF');\n        }\n        payloads.forEach(function (payload) {\n            mline.push(payload.id);\n        });\n    }\n\n\n    sdp.push('m=' + mline.join(' '));\n\n    sdp.push('c=IN IP4 0.0.0.0');\n    if (desc.bandwidth && desc.bandwidth.type && desc.bandwidth.bandwidth) {\n        sdp.push('b=' + desc.bandwidth.type + ':' + desc.bandwidth.bandwidth);\n    }\n    if (desc.applicationType == 'rtp') {\n        sdp.push('a=rtcp:1 IN IP4 0.0.0.0');\n    }\n\n    if (transport) {\n        if (transport.ufrag) {\n            sdp.push('a=ice-ufrag:' + transport.ufrag);\n        }\n        if (transport.pwd) {\n            sdp.push('a=ice-pwd:' + transport.pwd);\n        }\n\n        var pushedSetup = false;\n        fingerprints.forEach(function (fingerprint) {\n            sdp.push('a=fingerprint:' + fingerprint.hash + ' ' + fingerprint.value);\n            if (fingerprint.setup && !pushedSetup) {\n                sdp.push('a=setup:' + fingerprint.setup);\n            }\n        });\n\n        if (transport.sctp) {\n            transport.sctp.forEach(function (map) {\n                sdp.push('a=sctpmap:' + map.number + ' ' + map.protocol + ' ' + map.streams);\n            });\n        }\n    }\n\n    if (desc.applicationType == 'rtp') {\n        sdp.push('a=' + (SENDERS[role][direction][content.senders] || 'sendrecv'));\n    }\n    sdp.push('a=mid:' + content.name);\n\n    if (desc.sources && desc.sources.length) {\n        var streams = {};\n        desc.sources.forEach(function (source) {\n            (source.parameters || []).forEach(function (param) {\n                if (param.key === 'msid') {\n                    streams[param.value] = 1;\n                }\n            });\n        });\n        streams = Object.keys(streams);\n        if (streams.length === 1) {\n            sdp.push('a=msid:' + streams[0]);\n        }\n    }\n\n    if (desc.mux) {\n        sdp.push('a=rtcp-mux');\n    }\n\n    var encryption = desc.encryption || [];\n    encryption.forEach(function (crypto) {\n        sdp.push('a=crypto:' + crypto.tag + ' ' + crypto.cipherSuite + ' ' + crypto.keyParams + (crypto.sessionParams ? ' ' + crypto.sessionParams : ''));\n    });\n    if (desc.googConferenceFlag) {\n        sdp.push('a=x-google-flag:conference');\n    }\n\n    payloads.forEach(function (payload) {\n        var rtpmap = 'a=rtpmap:' + payload.id + ' ' + payload.name + '/' + payload.clockrate;\n        if (payload.channels && payload.channels != '1') {\n            rtpmap += '/' + payload.channels;\n        }\n        sdp.push(rtpmap);\n\n        if (payload.parameters && payload.parameters.length) {\n            var fmtp = ['a=fmtp:' + payload.id];\n            var parameters = [];\n            payload.parameters.forEach(function (param) {\n                parameters.push((param.key ? param.key + '=' : '') + param.value);\n            });\n            fmtp.push(parameters.join(';'));\n            sdp.push(fmtp.join(' '));\n        }\n\n        if (payload.feedback) {\n            payload.feedback.forEach(function (fb) {\n                if (fb.type === 'trr-int') {\n                    sdp.push('a=rtcp-fb:' + payload.id + ' trr-int ' + (fb.value ? fb.value : '0'));\n                } else {\n                    sdp.push('a=rtcp-fb:' + payload.id + ' ' + fb.type + (fb.subtype ? ' ' + fb.subtype : ''));\n                }\n            });\n        }\n    });\n\n    if (desc.feedback) {\n        desc.feedback.forEach(function (fb) {\n            if (fb.type === 'trr-int') {\n                sdp.push('a=rtcp-fb:* trr-int ' + (fb.value ? fb.value : '0'));\n            } else {\n                sdp.push('a=rtcp-fb:* ' + fb.type + (fb.subtype ? ' ' + fb.subtype : ''));\n            }\n        });\n    }\n\n    var hdrExts = desc.headerExtensions || [];\n    hdrExts.forEach(function (hdr) {\n        sdp.push('a=extmap:' + hdr.id + (hdr.senders ? '/' + SENDERS[role][direction][hdr.senders] : '') + ' ' + hdr.uri);\n    });\n\n    var ssrcGroups = desc.sourceGroups || [];\n    ssrcGroups.forEach(function (ssrcGroup) {\n        sdp.push('a=ssrc-group:' + ssrcGroup.semantics + ' ' + ssrcGroup.sources.join(' '));\n    });\n\n    var ssrcs = desc.sources || [];\n    ssrcs.forEach(function (ssrc) {\n        for (var i = 0; i < ssrc.parameters.length; i++) {\n            var param = ssrc.parameters[i];\n            sdp.push('a=ssrc:' + (ssrc.ssrc || desc.ssrc) + ' ' + param.key + (param.value ? (':' + param.value) : ''));\n        }\n    });\n\n    var candidates = transport.candidates || [];\n    candidates.forEach(function (candidate) {\n        sdp.push(exports.toCandidateSDP(candidate));\n    });\n\n    return sdp.join('\\r\\n');\n};\n\nexports.toCandidateSDP = function (candidate) {\n    var sdp = [];\n\n    sdp.push(candidate.foundation);\n    sdp.push(candidate.component);\n    sdp.push(candidate.protocol.toUpperCase());\n    sdp.push(candidate.priority);\n    sdp.push(candidate.ip);\n    sdp.push(candidate.port);\n\n    var type = candidate.type;\n    sdp.push('typ');\n    sdp.push(type);\n    if (type === 'srflx' || type === 'prflx' || type === 'relay') {\n        if (candidate.relAddr && candidate.relPort) {\n            sdp.push('raddr');\n            sdp.push(candidate.relAddr);\n            sdp.push('rport');\n            sdp.push(candidate.relPort);\n        }\n    }\n    if (candidate.tcpType && candidate.protocol.toUpperCase() == 'TCP') {\n        sdp.push('tcptype');\n        sdp.push(candidate.tcpType);\n    }\n\n    sdp.push('generation');\n    sdp.push(candidate.generation || '0');\n\n    // FIXME: apparently this is wrong per spec\n    // but then, we need this when actually putting this into\n    // SDP so it's going to stay.\n    // decision needs to be revisited when browsers dont\n    // accept this any longer\n    return 'a=candidate:' + sdp.join(' ');\n};\n"," /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.substr(17).split(' ');\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n}\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    commonShim: commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n","\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n/* iterates the stats graph recursively. */\nfunction walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(function(name) {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(function(id) {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nfunction filterStats(result, track, outbound) {\n  var streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  var filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  var trackStats = [];\n  result.forEach(function(value) {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(function(trackStat) {\n    result.forEach(function(stats) {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        },\n        enumerable: true,\n        configurable: true\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    } else if (!('RTCRtpTransceiver' in window)) {\n      utils.wrapPeerConnectionEvent(window, 'track', function(e) {\n        if (!e.transceiver) {\n          e.transceiver = {receiver: e.receiver};\n        }\n        return e;\n      });\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSenderReceiverGetStats: function(window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection &&\n        window.RTCRtpSender && window.RTCRtpReceiver)) {\n      return;\n    }\n\n    // shim sender stats.\n    if (!('getStats' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      if (origGetSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          var pc = this;\n          var senders = origGetSenders.apply(pc, []);\n          senders.forEach(function(sender) {\n            sender._pc = pc;\n          });\n          return senders;\n        };\n      }\n\n      var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      if (origAddTrack) {\n        window.RTCPeerConnection.prototype.addTrack = function() {\n          var sender = origAddTrack.apply(this, arguments);\n          sender._pc = this;\n          return sender;\n        };\n      }\n      window.RTCRtpSender.prototype.getStats = function() {\n        var sender = this;\n        return this._pc.getStats().then(function(result) {\n          /* Note: this will include stats of all senders that\n           *   send a track with the same id as sender.track as\n           *   it is not possible to identify the RTCRtpSender.\n           */\n          return filterStats(result, sender.track, true);\n        });\n      };\n    }\n\n    // shim receiver stats.\n    if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n      var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n      if (origGetReceivers) {\n        window.RTCPeerConnection.prototype.getReceivers = function() {\n          var pc = this;\n          var receivers = origGetReceivers.apply(pc, []);\n          receivers.forEach(function(receiver) {\n            receiver._pc = pc;\n          });\n          return receivers;\n        };\n      }\n      utils.wrapPeerConnectionEvent(window, 'track', function(e) {\n        e.receiver._pc = e.srcElement;\n        return e;\n      });\n      window.RTCRtpReceiver.prototype.getStats = function() {\n        var receiver = this;\n        return this._pc.getStats().then(function(result) {\n          return filterStats(result, receiver.track, false);\n        });\n      };\n    }\n\n    if (!('getStats' in window.RTCRtpSender.prototype &&\n        'getStats' in window.RTCRtpReceiver.prototype)) {\n      return;\n    }\n\n    // shim RTCPeerConnection.getStats(track).\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function() {\n      var pc = this;\n      if (arguments.length > 0 &&\n          arguments[0] instanceof window.MediaStreamTrack) {\n        var track = arguments[0];\n        var sender;\n        var receiver;\n        var err;\n        pc.getSenders().forEach(function(s) {\n          if (s.track === track) {\n            if (sender) {\n              err = true;\n            } else {\n              sender = s;\n            }\n          }\n        });\n        pc.getReceivers().forEach(function(r) {\n          if (r.track === track) {\n            if (receiver) {\n              err = true;\n            } else {\n              receiver = r;\n            }\n          }\n          return r.track === track;\n        });\n        if (err || (sender && receiver)) {\n          return Promise.reject(new DOMException(\n            'There are more than one sender or receiver for the track.',\n            'InvalidAccessError'));\n        } else if (sender) {\n          return sender.getStats();\n        } else if (receiver) {\n          return receiver.getStats();\n        }\n        return Promise.reject(new DOMException(\n          'There is no sender or receiver for the track.',\n          'InvalidAccessError'));\n      }\n      return origGetStats.apply(pc, arguments);\n    };\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrackWithNative: function(window) {\n    // shim addTrack/removeTrack with native variants in order to make\n    // the interactions with legacy getLocalStreams behave as in other browsers.\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {\n        return pc._shimmedLocalStreams[streamId][0];\n      });\n    };\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      var sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      var existingSenders = pc.getSenders();\n      origAddStream.apply(this, arguments);\n      var newSenders = pc.getSenders().filter(function(newSender) {\n        return existingSenders.indexOf(newSender) === -1;\n      });\n      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {\n          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            pc._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (pc._shimmedLocalStreams[streamId].length === 1) {\n            delete pc._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 65) {\n      return this.shimAddTrackRemoveTrackWithNative(window);\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      pc._reverseStreams = pc._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return pc._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var pc = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(pc, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var pc = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(pc, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var pc = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(pc, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  },\n\n  fixNegotiationNeeded: function(window) {\n    utils.wrapPeerConnectionEvent(window, 'negotiationneeded', function(e) {\n      var pc = e.target;\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n      return e;\n    });\n  },\n\n  shimGetDisplayMedia: function(window, getSourceId) {\n    if ('getDisplayMedia' in window.navigator) {\n      return;\n    }\n    // getSourceId is a function that returns a promise resolving with\n    // the sourceId of the screen/window/tab to be shared.\n    if (typeof getSourceId !== 'function') {\n      console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n          'a function');\n      return;\n    }\n    navigator.getDisplayMedia = function(constraints) {\n      return getSourceId(constraints)\n        .then(function(sourceId) {\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: constraints.video.frameRate || 3\n            }\n          };\n          return navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype)) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      if (args.candidate && args.candidate.length) {\n        // Augment the native candidate with the parsed fields.\n        var nativeCandidate = new NativeRTCIceCandidate(args);\n        var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n        var augmentedCandidate = Object.assign(nativeCandidate,\n            parsedCandidate);\n\n        // Add a serializer that does not serialize the extra attributes.\n        augmentedCandidate.toJSON = function() {\n          return {\n            candidate: augmentedCandidate.candidate,\n            sdpMid: augmentedCandidate.sdpMid,\n            sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n            usernameFragment: augmentedCandidate.usernameFragment,\n          };\n        };\n        return augmentedCandidate;\n      }\n      return new NativeRTCIceCandidate(args);\n    };\n    window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    utils.wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  },\n\n  shimMaxMessageSize: function(window) {\n    if (window.RTCSctpTransport || !window.RTCPeerConnection) {\n      return;\n    }\n    var browserDetails = utils.detectBrowser(window);\n\n    if (!('sctp' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n        get: function() {\n          return typeof this._sctp === 'undefined' ? null : this._sctp;\n        }\n      });\n    }\n\n    var sctpInDescription = function(description) {\n      var sections = SDPUtils.splitSections(description.sdp);\n      sections.shift();\n      return sections.some(function(mediaSection) {\n        var mLine = SDPUtils.parseMLine(mediaSection);\n        return mLine && mLine.kind === 'application'\n            && mLine.protocol.indexOf('SCTP') !== -1;\n      });\n    };\n\n    var getRemoteFirefoxVersion = function(description) {\n      // TODO: Is there a better solution for detecting Firefox?\n      var match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n      if (match === null || match.length < 2) {\n        return -1;\n      }\n      var version = parseInt(match[1], 10);\n      // Test for NaN (yes, this is ugly)\n      return version !== version ? -1 : version;\n    };\n\n    var getCanSendMaxMessageSize = function(remoteIsFirefox) {\n      // Every implementation we know can send at least 64 KiB.\n      // Note: Although Chrome is technically able to send up to 256 KiB, the\n      //       data does not reach the other peer reliably.\n      //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n      var canSendMaxMessageSize = 65536;\n      if (browserDetails.browser === 'firefox') {\n        if (browserDetails.version < 57) {\n          if (remoteIsFirefox === -1) {\n            // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n            // fragmentation.\n            canSendMaxMessageSize = 16384;\n          } else {\n            // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n            // messages. Thus, supporting ~2 GiB when sending.\n            canSendMaxMessageSize = 2147483637;\n          }\n        } else if (browserDetails.version < 60) {\n          // Currently, all FF >= 57 will reset the remote maximum message size\n          // to the default value when a data channel is created at a later\n          // stage. :(\n          // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n          canSendMaxMessageSize =\n            browserDetails.version === 57 ? 65535 : 65536;\n        } else {\n          // FF >= 60 supports sending ~2 GiB\n          canSendMaxMessageSize = 2147483637;\n        }\n      }\n      return canSendMaxMessageSize;\n    };\n\n    var getMaxMessageSize = function(description, remoteIsFirefox) {\n      // Note: 65536 bytes is the default value from the SDP spec. Also,\n      //       every implementation we know supports receiving 65536 bytes.\n      var maxMessageSize = 65536;\n\n      // FF 57 has a slightly incorrect default remote max message size, so\n      // we need to adjust it here to avoid a failure when sending.\n      // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n      if (browserDetails.browser === 'firefox'\n           && browserDetails.version === 57) {\n        maxMessageSize = 65535;\n      }\n\n      var match = SDPUtils.matchPrefix(description.sdp, 'a=max-message-size:');\n      if (match.length > 0) {\n        maxMessageSize = parseInt(match[0].substr(19), 10);\n      } else if (browserDetails.browser === 'firefox' &&\n                  remoteIsFirefox !== -1) {\n        // If the maximum message size is not present in the remote SDP and\n        // both local and remote are Firefox, the remote peer can receive\n        // ~2 GiB.\n        maxMessageSize = 2147483637;\n      }\n      return maxMessageSize;\n    };\n\n    var origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n      var pc = this;\n      pc._sctp = null;\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        var isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        var canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        var remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        var maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        var sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get: function() {\n            return maxMessageSize;\n          }\n        });\n        pc._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(pc, arguments);\n    };\n  },\n\n  shimSendThrowTypeError: function(window) {\n    if (!(window.RTCPeerConnection &&\n        'createDataChannel' in window.RTCPeerConnection.prototype)) {\n      return;\n    }\n\n    // Note: Although Firefox >= 57 has a native implementation, the maximum\n    //       message size can be reset for all data channels at a later stage.\n    //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n    function wrapDcSend(dc, pc) {\n      var origDataChannelSend = dc.send;\n      dc.send = function() {\n        var data = arguments[0];\n        var length = data.length || data.size || data.byteLength;\n        if (dc.readyState === 'open' &&\n            pc.sctp && length > pc.sctp.maxMessageSize) {\n          throw new TypeError('Message too large (can send a maximum of ' +\n            pc.sctp.maxMessageSize + ' bytes)');\n        }\n        return origDataChannelSend.apply(dc, arguments);\n      };\n    }\n    var origCreateDataChannel =\n      window.RTCPeerConnection.prototype.createDataChannel;\n    window.RTCPeerConnection.prototype.createDataChannel = function() {\n      var pc = this;\n      var dataChannel = origCreateDataChannel.apply(pc, arguments);\n      wrapDcSend(dataChannel, pc);\n      return dataChannel;\n    };\n    utils.wrapPeerConnectionEvent(window, 'datachannel', function(e) {\n      wrapDcSend(e.channel, e.target);\n      return e;\n    });\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar filterIceServers = require('./filtericeservers');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n    // Edge currently only implements the RTCDtmfSender, not the\n    // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n    if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n      window.RTCDTMFSender = window.RTCDtmfSender;\n    }\n\n    var RTCPeerConnectionShim = shimRTCPeerConnection(window,\n        browserDetails.version);\n    window.RTCPeerConnection = function(config) {\n      if (config && config.iceServers) {\n        config.iceServers = filterIceServers(config.iceServers);\n      }\n      return new RTCPeerConnectionShim(config);\n    };\n    window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nmodule.exports = function(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimSenderGetStats: function(window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection &&\n        window.RTCRtpSender)) {\n      return;\n    }\n    if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n      return;\n    }\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n    }\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function() {\n        var sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function() {\n      return this.track ? this._pc.getStats(this.track) :\n          Promise.resolve(new Map());\n    };\n  },\n\n  shimReceiverGetStats: function(window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection &&\n        window.RTCRtpSender)) {\n      return;\n    }\n    if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n      return;\n    }\n    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers = function() {\n        var pc = this;\n        var receivers = origGetReceivers.apply(pc, []);\n        receivers.forEach(function(receiver) {\n          receiver._pc = pc;\n        });\n        return receivers;\n      };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', function(e) {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function() {\n      return this._pc.getStats(this.track);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  },\n\n  shimRTCDataChannel: function(window) {\n    // rename DataChannel to RTCDataChannel (native fix in FF60):\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n    if (window.DataChannel && !window.RTCDataChannel) {\n      window.RTCDataChannel = window.DataChannel;\n    }\n  },\n\n  shimGetDisplayMedia: function(window, preferredMediaSource) {\n    if ('getDisplayMedia' in window.navigator) {\n      return;\n    }\n    navigator.getDisplayMedia = function(constraints) {\n      if (!(constraints && constraints.video)) {\n        var err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return navigator.mediaDevices.getUserMedia(constraints);\n    };\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          var pc = this;\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(function(stream) {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              var event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\n        }\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\n        }\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      var modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        cb(modifiedEvent);\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\n// Utility methods.\nmodule.exports = {\n  extractVersion: extractVersion,\n  wrapPeerConnectionEvent: wrapPeerConnectionEvent,\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    if (navigator.mozGetUserMedia) { // Firefox.\n      result.browser = 'firefox';\n      result.version = extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera.\n      // Version matches Chrome/WebRTC version.\n      result.browser = 'chrome';\n      result.version = extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (window.RTCPeerConnection &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n      result.browser = 'safari';\n      result.version = extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"webrtc-troubleshooter\"] = factory();\n\telse\n\t\troot[\"webrtc-troubleshooter\"] = factory();\n})(global, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/StatsGatherer.js\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/StatsGatherer.js\":\n/*!******************************!*\\\n  !*** ./src/StatsGatherer.js ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _events = __webpack_require__(/*! events */ \"events\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar IS_BROWSER = void 0;\n\nvar StatsGatherer = function (_EventEmitter) {\n  _inherits(StatsGatherer, _EventEmitter);\n\n  function StatsGatherer(peerConnection) {\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, StatsGatherer);\n\n    IS_BROWSER = typeof window !== 'undefined';\n\n    var _this = _possibleConstructorReturn(this, (StatsGatherer.__proto__ || Object.getPrototypeOf(StatsGatherer)).call(this));\n\n    _this.connection = peerConnection;\n    _this.session = opts.session;\n    _this.initiator = opts.initiator;\n    _this.conference = opts.conference;\n\n    _this.statsInterval = (opts.interval || 5) * 1000;\n    _this.lastResult = {};\n    _this.lastActiveLocalCandidate = null;\n\n    _this._pollingInterval = null;\n\n    _this._haveConnectionMetrics = false;\n    _this._iceStartTime = null;\n    _this._iceConnectionTime = null;\n\n    _this.traceData = [];\n\n    _this.logger = opts.logger || console;\n\n    _this.collectTraces();\n    return _this;\n  }\n\n  _createClass(StatsGatherer, [{\n    key: '_polyFillStats',\n    value: function _polyFillStats(results) {\n      if (!results || Array.isArray(results)) {\n        return results;\n      }\n      var betterResults = [];\n      if (typeof window.RTCStatsReport !== 'undefined' && results instanceof window.RTCStatsReport) {\n        results.forEach(function (value, key) {\n          betterResults.push({ key: key, value: value });\n        });\n      } else if (Object.keys(results).length > 0) {\n        Object.keys(results).forEach(function (key) {\n          betterResults.push({\n            key: key,\n            value: results[key]\n          });\n        });\n      } else {\n        this.logger.warn('Unknown stats results format, returning unmodified', results);\n        return results;\n      }\n      return betterResults;\n    }\n  }, {\n    key: '_gatherStats',\n    value: function _gatherStats() {\n      try {\n        if (this.connection.pc.peerconnection) {\n          return this.connection.pc.peerconnection.getStats(null).then(this._polyFillStats);\n        }\n        return this.connection.pc.getStats(null).then(this._polyFillStats);\n      } catch (e) {\n        this.logger.error('Failed to gather stats. Are you using RTCPeerConnection as your connection? {expect connection.pc.peerconnection.getStats}', this.connection);\n        return Promise.reject(e);\n      }\n    }\n  }, {\n    key: '_checkLastActiveCandidate',\n    value: function _checkLastActiveCandidate(_ref) {\n      var localId = _ref.localId,\n          remoteId = _ref.remoteId,\n          key = _ref.key,\n          report = _ref.report;\n\n      if (localId && report.type === 'localcandidate' && report.id === localId) {\n        this.lastActiveLocalCandidate = report;\n      }\n      if (remoteId && report.type === 'remotecandidate' && report.id === remoteId) {\n        this.lastActiveRemoteCandidate = report;\n      }\n    }\n  }, {\n    key: '_processReport',\n    value: function _processReport(_ref2) {\n      var _this2 = this;\n\n      var key = _ref2.key,\n          report = _ref2.report,\n          results = _ref2.results,\n          event = _ref2.event;\n\n      var now = new Date(report.timestamp);\n      var track = report.trackIdentifier || report.googTrackId || key;\n      var kind = report.mediaType;\n\n      var activeSource = !!(report.type === 'ssrc' && (report.bytesSent || report.bytesReceived));\n\n      if (!activeSource) {\n        // if not active source, is this the active candidate pair?\n        var selected = report.type === 'candidatepair' && report.selected;\n        var specSepected = report.type === 'candidate-pair' && report.nominated && report.state === 'succeeded';\n        var chromeSelected = report.type === 'googCandidatePair' && report.googActiveConnection === 'true';\n\n        if (selected || chromeSelected || specSepected) {\n          // this is the active candidate pair, check if it's the same id as last one\n          var localId = report.localCandidateId;\n          var remoteId = report.remoteCandidateId;\n\n          event.localCandidateChanged = !!this.lastActiveLocalCandidate && localId !== this.lastActiveLocalCandidate.id;\n          event.remoteCandidateChanged = !!this.lastActiveRemoteCandidate && remoteId !== this.lastActiveRemoteCandidate.id;\n\n          if (!this.lastActiveLocalCandidate || event.localCandidateChanged || event.remoteCandidateChanged) {\n            results.forEach(function (result) {\n              _this2._checkLastActiveCandidate({\n                localId: localId,\n                remoteId: remoteId,\n                key: result.key,\n                report: result.value\n              });\n            });\n          }\n\n          if (this.lastActiveLocalCandidate) {\n            event.networkType = this.lastActiveLocalCandidate.networkType;\n            if (this.lastActiveRemoteCandidate) {\n              event.candidatePair = this.lastActiveLocalCandidate.candidateType + ';' + this.lastActiveRemoteCandidate.candidateType;\n            }\n          }\n        }\n        return;\n      }\n\n      var local = !!report.bytesSent;\n\n      var lastResultReport = void 0;\n      if (!this.lastResult) {\n        return;\n      }\n      lastResultReport = this.lastResult.find && this.lastResult.find(function (r) {\n        return r.key === key;\n      });\n      lastResultReport = lastResultReport && lastResultReport.value;\n      if (!lastResultReport || lastResultReport.timestamp >= now) {\n        return;\n      }\n\n      // Chrome does not provide a mediaType field, so we have to manually inspect\n      // the tracks to find the media type.\n      if (!kind) {\n        this.connection.getLocalStreams()[0].getTracks().forEach(function (track) {\n          if (track.id === report.googTrackId) {\n            kind = track.kind;\n          }\n        });\n      }\n\n      var muted = false;\n      // We still didn't find the media type, so the local track is muted\n      if (!kind) {\n        muted = true;\n        // Try to guess the media type from the codec\n        if (report.googCodecName) {\n          var codec = report.googCodecName.toLowerCase();\n          if (codec === 'vp8') {\n            kind = 'video';\n          } else if (codec === 'opus') {\n            kind = 'audio';\n          }\n        }\n      }\n\n      var bytes = parseInt(local ? report.bytesSent : report.bytesReceived, 10) || 0;\n      var previousBytesTotal = parseInt(local ? lastResultReport.bytesSent : lastResultReport.bytesReceived, 10) || 0;\n      var deltaTime = now - new Date(lastResultReport.timestamp);\n      var bitrate = Math.floor(8 * (bytes - previousBytesTotal) / deltaTime);\n      var bytesSent = parseInt(report.bytesSent, 10) || -1;\n      var bytesReceived = parseInt(report.bytesReceived, 10) || -1;\n\n      var rtt = parseInt(report.googRtt || report.mozRtt || report.roundTripTime, 10) || -1;\n      if (rtt !== -1) {\n        event[kind + 'Rtt'] = rtt;\n      }\n\n      var jitter = parseInt(report.googJitterReceived || report.mozJitterReceived || report.jitter, 10) || -1;\n      if (jitter !== -1) {\n        event[kind + 'Jitter'] = jitter;\n      }\n\n      var lost = 0;\n      var previousLost = 0;\n      var total = 0;\n      var previousTotal = 0;\n      var remoteItem = void 0;\n\n      remoteItem = results.find(function (r) {\n        return r.key === report.remoteId;\n      });\n      if (report.remoteId && remoteItem) {\n        lost = remoteItem.packetsLost;\n        previousLost = lastResultReport.packetsLost;\n\n        if (lost < previousLost) {\n          this.logger.warn('Possible stats bug: current lost should not be less than previousLost. Overriding current lost with previousLost.', { lost: lost, previousLost: previousLost });\n          lost = previousLost;\n          remoteItem.packetsLost = lost;\n        }\n      } else if (report.packetsLost || report.packetsSent || report.packetsReceived) {\n        if (report.packetsLost) {\n          lost = parseInt(report.packetsLost, 10) || 0;\n          previousLost = parseInt(lastResultReport.packetsLost, 10) || 0;\n\n          if (lost < previousLost) {\n            this.logger.warn('Possible stats bug: current lost should not be less than previousLost. Overriding current lost with previousLost.', { lost: lost, previousLost: previousLost });\n            lost = previousLost;\n            report.packetsLost = '' + lost;\n          }\n        }\n        if (local && report.packetsSent) {\n          total = parseInt(report.packetsSent, 10) || 0;\n          previousTotal = parseInt(lastResultReport.packetsSent, 10) || 0;\n        }\n        if (!local && report.packetsReceived) {\n          total = parseInt(report.packetsReceived, 10) || 0;\n          previousTotal = parseInt(lastResultReport.packetsReceived, 10) || 0;\n        }\n      }\n\n      var loss = 0;\n      if (total > 0) {\n        loss = Math.floor(lost / total * 100);\n      }\n\n      var intervalLoss = Math.floor((lost - previousLost) / (total - previousTotal) * 100) || 0;\n\n      // TODO: for 2.0 - remove `lost` which is an integer of packets lost,\n      // and use only `loss` which is percentage loss\n      var trackInfo = {\n        track: track,\n        kind: kind,\n        bitrate: bitrate,\n        lost: lost,\n        muted: muted,\n        loss: loss,\n        intervalLoss: intervalLoss,\n        bytesSent: bytesSent,\n        bytesReceived: bytesReceived\n      };\n\n      if (kind === 'audio') {\n        trackInfo.aecDivergentFilterFraction = parseInt(report.aecDivergentFilterFraction, 10) || 0;\n        trackInfo.googEchoCanellationEchoDelayMedian = parseInt(report.googEchoCanellationEchoDelayMedian, 10) || 0;\n        trackInfo.googEchoCancellationEchoDelayStdDev = parseInt(report.googEchoCancellationEchoDelayStdDev, 10) || 0;\n        trackInfo.googEchoCancellationReturnLoss = parseInt(report.googEchoCancellationReturnLoss, 10) || 0;\n        trackInfo.googEchoCancellationReturnLossEnhancement = parseInt(report.googEchoCancellationReturnLossEnhancement, 10) || 0;\n      }\n\n      if (kind === 'audio' && report.audioInputLevel) {\n        trackInfo.audioInputLevel = parseInt(report.audioInputLevel, 10) || 0;\n      }\n\n      if (local) {\n        event.tracks.push(trackInfo);\n      } else {\n        event.remoteTracks.push(trackInfo);\n      }\n    }\n  }, {\n    key: '_createStatsReport',\n    value: function _createStatsReport(results, updateLastResult) {\n      var _this3 = this;\n\n      var event = {\n        name: 'getStats',\n        session: this.session,\n        initiator: this.initiator,\n        conference: this.conference,\n        tracks: [],\n        remoteTracks: []\n      };\n\n      results = this._polyFillStats(results);\n\n      results.forEach(function (result) {\n        _this3._processReport({\n          key: result.key,\n          report: result.value,\n          results: results,\n          event: event\n        });\n      });\n\n      if (updateLastResult) {\n        this.lastResult = results;\n      }\n\n      return event;\n    }\n  }, {\n    key: 'collectTraces',\n    value: function collectTraces() {\n      var _this4 = this;\n\n      this.connection.on('PeerConnectionTrace', function (data) {\n        _this4.traceData.push(data);\n      });\n\n      this.connection.on('error', function () {\n        _this4.emit('traces', {\n          name: 'trace',\n          session: _this4.session,\n          initiator: _this4.initiator,\n          conference: _this4.conference,\n          traces: _this4.traceData\n        });\n      });\n    }\n  }, {\n    key: 'collectStats',\n    value: function collectStats() {\n      var _this5 = this;\n\n      this.connection.on('iceConnectionStateChange', function () {\n        var state = _this5.connection.iceConnectionState;\n\n        if (state === 'connected' || state === 'completed') {\n          if (_this5._pollingInterval !== null) {\n            return;\n          }\n\n          var statsPoll = function statsPoll() {\n            _this5._gatherStats().then(function (reports) {\n              var event = _this5._createStatsReport(reports, true);\n              if (event.tracks.length > 0 || event.remoteTracks.length > 0) {\n                _this5.emit('stats', event);\n              }\n            });\n          };\n\n          if (IS_BROWSER) {\n            window.setTimeout(statsPoll, 0);\n            _this5._pollingInterval = window.setInterval(statsPoll, _this5.statsInterval);\n          }\n        }\n\n        if (state === 'disconnected') {\n          if (_this5.connection.signalingState !== 'stable') {\n            return;\n          }\n\n          _this5._gatherStats().then(function (reports) {\n            var event = _this5._createStatsReport(reports);\n            event.type = 'iceDisconnected';\n            _this5.emit('stats', event);\n          });\n        }\n\n        if (state === 'closed') {\n          if (_this5._pollingInterval) {\n            if (IS_BROWSER) {\n              window.clearInterval(_this5._pollingInterval);\n            }\n            _this5._pollingInterval = null;\n          }\n        }\n      });\n    }\n  }, {\n    key: 'collectInitialConnectionStats',\n    value: function collectInitialConnectionStats() {\n      var _this6 = this;\n\n      this.connection.on('iceConnectionStateChange', function () {\n        var state = _this6.connection.iceConnectionState;\n\n        if (state === 'checking') {\n          if (IS_BROWSER) {\n            _this6._iceStartTime = window.performance.now();\n          }\n        }\n\n        if (state === 'connected' || state === 'completed') {\n          if (_this6._haveConnectionMetrics) {\n            return;\n          }\n\n          _this6._haveConnectionMetrics = true;\n          var userAgent = void 0,\n              platform = void 0,\n              cores = void 0;\n          if (IS_BROWSER) {\n            _this6._iceConnectionTime = window.performance.now() - _this6._iceStartTime;\n            userAgent = window.navigator.userAgent;\n            platform = window.navigator.platform;\n            cores = window.navigator.hardwareConcurrency;\n          }\n\n          _this6._gatherStats().then(function (reports) {\n            var event = {\n              name: 'connect',\n              userAgent: userAgent,\n              platform: platform,\n              cores: cores,\n              session: _this6.session,\n              initiator: _this6.initiator,\n              conference: _this6.conference,\n              connectTime: _this6._iceConnectionTime,\n              hadLocalIPv6Candidate: _this6.connection.hadLocalIPv6Candidate,\n              hadRemoteIPv6Candidate: _this6.connection.hadRemoteIPv6Candidate,\n              hadLocalRelayCandidate: _this6.connection.hadLocalRelayCandidate,\n              hadRemoteRelayCandidate: _this6.connection.hadremoteRelayCandidate\n            };\n\n            var activeCandidatePair = null;\n            var activeCandidatePairId = void 0;\n            reports.forEach(function (_ref3) {\n              var key = _ref3.key,\n                  value = _ref3.value;\n\n              var report = value;\n              var selected = report.type === 'candidatepair' && report.selected;\n              var specSepected = report.type === 'candidate-pair' && report.nominated && report.state === 'succeeded';\n              var chromeSelected = report.type === 'googCandidatePair' && report.googActiveConnection === 'true';\n              if (selected || chromeSelected || specSepected) {\n                activeCandidatePair = report;\n              }\n\n              if (report.selectedCandidatePairId) {\n                activeCandidatePairId = report.selectedCandidatePairId;\n              }\n\n              event.dtlsCipher = event.dtlsCipher || report.dtlsCipher;\n              event.srtpCipher = event.srtpCipher || report.srtpCipher;\n            });\n\n            if (!activeCandidatePair && activeCandidatePairId) {\n              var report = reports.find(function (r) {\n                return r.value.id === activeCandidatePairId;\n              });\n              if (report) {\n                activeCandidatePair = report.value;\n              }\n            }\n\n            if (activeCandidatePair) {\n              var localId = activeCandidatePair.localCandidateId;\n              var remoteId = activeCandidatePair.remoteCandidateId;\n              var localCandidate = void 0,\n                  remoteCandidate = void 0;\n\n              reports.forEach(function (_ref4) {\n                var key = _ref4.key,\n                    value = _ref4.value;\n\n                var report = value;\n                if (localId && (report.type === 'localcandidate' || report.type === 'local-candidate') && report.id === localId) {\n                  localCandidate = report;\n                  event.localCandidateType = report.candidateType;\n                }\n\n                if (remoteId && (report.type === 'remotecandidate' || report.type === 'remote-candidate') && report.id === remoteId) {\n                  remoteCandidate = report;\n                  event.remoteCandidateType = report.candidateType;\n                }\n              });\n\n              if (localCandidate && remoteCandidate) {\n                event.candidatePair = localCandidate.candidateType + ';' + remoteCandidate.candidateType;\n                event.candidatePairDetails = {\n                  local: localCandidate,\n                  remote: remoteCandidate\n                };\n              }\n\n              if (localCandidate) {\n                event.transport = localCandidate.transport || localCandidate.protocol;\n                if (localCandidate.priority) {\n                  // Chrome-specific mapping;\n                  // but only chrome has priority set on the candidate currently.\n                  var turnTypes = {\n                    2: 'udp',\n                    1: 'tcp',\n                    0: 'tls'\n                  };\n\n                  var priority = parseInt(localCandidate.priority, 10);\n                  event.turnType = turnTypes[priority >> 24];\n                  event.networkType = localCandidate.networkType;\n                }\n\n                event.usingIPv6 = localCandidate.ipAddress && localCandidate.ipAddress.indexOf('[') === 0;\n              }\n            }\n            _this6.emit('stats', event);\n          });\n        }\n\n        if (state === 'failed') {\n          if (IS_BROWSER) {\n            _this6._iceFailedTime = window.performance.now() - _this6._iceStartTime;\n          }\n          _this6._gatherStats().then(function (reports) {\n            var event = {\n              name: 'failure',\n              session: _this6.session,\n              initiator: _this6.initiator,\n              conference: _this6.conference,\n              failTime: _this6._iceFailureTime,\n              iceRW: 0,\n              numLocalHostCandidates: 0,\n              numLocalSrflxCandidates: 0,\n              numLocalRelayCandidates: 0,\n              numRemoteHostCandidates: 0,\n              numRemoteSrflxCandidates: 0,\n              numRemoteRelayCandidates: 0\n            };\n\n            reports.forEach(function (_ref5) {\n              var key = _ref5.key,\n                  value = _ref5.value;\n\n              var report = value;\n              if (report.type === 'googCandidatePair') {\n                if (report.googWritable === 'true' && report.googReadable === 'true') {\n                  event.iceRW++;\n                }\n              }\n            });\n\n            var localCandidates = _this6.connection.pc.localDescription.sdp.split('\\r\\n').filter(function (line) {\n              return line.indexOf('a=candidate:') > -1;\n            });\n            var remoteCandidates = _this6.connection.pc.remoteDescription.sdp.split('\\r\\n').filter(function (line) {\n              return line.indexOf('a=candidate:') > -1;\n            });\n\n            ['Host', 'Srflx', 'Relay'].forEach(function (type) {\n              event['numLocal' + type + 'Candidates'] = localCandidates.filter(function (line) {\n                return line.split(' ')[7] === type.toLowerCase();\n              }).length;\n              event['numRemote' + type + 'Candidates'] = remoteCandidates.filter(function (line) {\n                return line.split(' ')[7] === type.toLowerCase();\n              }).length;\n            });\n\n            _this6.emit('stats', event);\n            _this6.emit('traces', {\n              name: 'trace',\n              session: _this6.session,\n              initiator: _this6.initiator,\n              conference: _this6.conference,\n              traces: _this6.traceData\n            });\n          });\n        }\n      });\n    }\n  }]);\n\n  return StatsGatherer;\n}(_events.EventEmitter);\n\nmodule.exports = StatsGatherer;\n\n/***/ }),\n\n/***/ \"events\":\n/*!*************************!*\\\n  !*** external \"events\" ***!\n  \\*************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"events\");\n\n/***/ })\n\n/******/ });\n});\n//# sourceMappingURL=webrtc-stats-gatherer.js.map","/*\r\nWildEmitter.js is a slim little event emitter by @henrikjoreteg largely based\r\non @visionmedia's Emitter from UI Kit.\r\n\r\nWhy? I wanted it standalone.\r\n\r\nI also wanted support for wildcard emitters like this:\r\n\r\nemitter.on('*', function (eventName, other, event, payloads) {\r\n\r\n});\r\n\r\nemitter.on('somenamespace*', function (eventName, payloads) {\r\n\r\n});\r\n\r\nPlease note that callbacks triggered by wildcard registered events also get\r\nthe event name as the first argument.\r\n*/\r\n\r\nmodule.exports = WildEmitter;\r\n\r\nfunction WildEmitter() { }\r\n\r\nWildEmitter.mixin = function (constructor) {\r\n    var prototype = constructor.prototype || constructor;\r\n\r\n    prototype.isWildEmitter= true;\r\n\r\n    // Listen on the given `event` with `fn`. Store a group name if present.\r\n    prototype.on = function (event, groupName, fn) {\r\n        this.callbacks = this.callbacks || {};\r\n        var hasGroup = (arguments.length === 3),\r\n            group = hasGroup ? arguments[1] : undefined,\r\n            func = hasGroup ? arguments[2] : arguments[1];\r\n        func._groupName = group;\r\n        (this.callbacks[event] = this.callbacks[event] || []).push(func);\r\n        return this;\r\n    };\r\n\r\n    // Adds an `event` listener that will be invoked a single\r\n    // time then automatically removed.\r\n    prototype.once = function (event, groupName, fn) {\r\n        var self = this,\r\n            hasGroup = (arguments.length === 3),\r\n            group = hasGroup ? arguments[1] : undefined,\r\n            func = hasGroup ? arguments[2] : arguments[1];\r\n        function on() {\r\n            self.off(event, on);\r\n            func.apply(this, arguments);\r\n        }\r\n        this.on(event, group, on);\r\n        return this;\r\n    };\r\n\r\n    // Unbinds an entire group\r\n    prototype.releaseGroup = function (groupName) {\r\n        this.callbacks = this.callbacks || {};\r\n        var item, i, len, handlers;\r\n        for (item in this.callbacks) {\r\n            handlers = this.callbacks[item];\r\n            for (i = 0, len = handlers.length; i < len; i++) {\r\n                if (handlers[i]._groupName === groupName) {\r\n                    //console.log('removing');\r\n                    // remove it and shorten the array we're looping through\r\n                    handlers.splice(i, 1);\r\n                    i--;\r\n                    len--;\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n\r\n    // Remove the given callback for `event` or all\r\n    // registered callbacks.\r\n    prototype.off = function (event, fn) {\r\n        this.callbacks = this.callbacks || {};\r\n        var callbacks = this.callbacks[event],\r\n            i;\r\n\r\n        if (!callbacks) return this;\r\n\r\n        // remove all handlers\r\n        if (arguments.length === 1) {\r\n            delete this.callbacks[event];\r\n            return this;\r\n        }\r\n\r\n        // remove specific handler\r\n        i = callbacks.indexOf(fn);\r\n        callbacks.splice(i, 1);\r\n        if (callbacks.length === 0) {\r\n            delete this.callbacks[event];\r\n        }\r\n        return this;\r\n    };\r\n\r\n    /// Emit `event` with the given args.\r\n    // also calls any `*` handlers\r\n    prototype.emit = function (event) {\r\n        this.callbacks = this.callbacks || {};\r\n        var args = [].slice.call(arguments, 1),\r\n            callbacks = this.callbacks[event],\r\n            specialCallbacks = this.getWildcardCallbacks(event),\r\n            i,\r\n            len,\r\n            item,\r\n            listeners;\r\n\r\n        if (callbacks) {\r\n            listeners = callbacks.slice();\r\n            for (i = 0, len = listeners.length; i < len; ++i) {\r\n                if (!listeners[i]) {\r\n                    break;\r\n                }\r\n                listeners[i].apply(this, args);\r\n            }\r\n        }\r\n\r\n        if (specialCallbacks) {\r\n            len = specialCallbacks.length;\r\n            listeners = specialCallbacks.slice();\r\n            for (i = 0, len = listeners.length; i < len; ++i) {\r\n                if (!listeners[i]) {\r\n                    break;\r\n                }\r\n                listeners[i].apply(this, [event].concat(args));\r\n            }\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    // Helper for for finding special wildcard event handlers that match the event\r\n    prototype.getWildcardCallbacks = function (eventName) {\r\n        this.callbacks = this.callbacks || {};\r\n        var item,\r\n            split,\r\n            result = [];\r\n\r\n        for (item in this.callbacks) {\r\n            split = item.split('*');\r\n            if (item === '*' || (split.length === 2 && eventName.slice(0, split[0].length) === split[0])) {\r\n                result = result.concat(this.callbacks[item]);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n};\r\n\r\nWildEmitter.mixin(WildEmitter);\r\n","import AudioTest from './diagnostics/AudioTest';\nimport VideoTest from './diagnostics/VideoTest';\nimport ConnectivityTest from './diagnostics/ConnectivityTest';\nimport ThroughputTest from './diagnostics/DataThroughputTest';\nimport VideoBandwidthTest from './diagnostics/VideoBandwidthTest';\nimport AudioBandwidthTest from './diagnostics/AudioBandwidthTest';\nimport SymmetricNatTest from './diagnostics/SymmetricNatTest';\n\nexport {\n  AudioTest,\n  VideoTest,\n  ConnectivityTest,\n  ThroughputTest,\n  VideoBandwidthTest,\n  AudioBandwidthTest,\n  SymmetricNatTest\n};\n","// adapted from https://github.com/webrtc/testrtc/blob/master/src/js/bandwidth_test.js\n\nimport WebrtcCall from '../utils/WebrtcCall';\nimport Test from '../utils/Test';\nimport StatisticsAggregate from '../utils/StatisticsAggregate';\nimport ERROR_CODES from '../utils/testErrorCodes';\n\nexport default class AudioBandwidthTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Audio Bandwidth Test';\n    this.maxAudioBitrateKbps = 510;\n    this.durationMs = 40000;\n    this.statStepMs = 100;\n    this.bweStats = new StatisticsAggregate(0.75 * this.maxAudioBitrateKbps * 1000);\n    this.rttStats = new StatisticsAggregate();\n    this.packetsLost = null;\n    this.startTime = null;\n    this.call = null;\n    // No Camera for audio only test\n    this.constraints = {\n      video: false\n    };\n\n    if (this.options.mediaOptions.audio.deviceId) {\n      this.constraints.audio = {deviceId: this.options.mediaOptions.audio.deviceId};\n    } else {\n      this.constraints.audio = true;\n    }\n\n    this.log = [];\n    this.stats = {};\n  }\n\n  start () {\n    super.start();\n\n    if (!this.options.iceConfig.iceServers.length) {\n      const error = new Error('No ice servers were provided');\n      error.pcCode = ERROR_CODES.ICE;\n      error.details = this.log;\n      return this.reject(error);\n    }\n    this.call = new WebrtcCall(this.options.iceConfig, this.logger);\n    this.call.setIceCandidateFilter(WebrtcCall.isRelay);\n\n    return this.doGetUserMedia(this.constraints)\n      .then(stream => this.setupCall(stream))\n      .then(this.runTest.bind(this))\n      .then(this.completed.bind(this))\n      .then(() => {\n        if (this.hasError) {\n          return Promise.reject(new Error('Audio Bandwidth Error'));\n        }\n\n        return this.resolve(this.getResults());\n      })\n      .catch(err => {\n        err.pcCode = ERROR_CODES.MEDIA;\n        const results = this.getResults();\n        results.error = err;\n        return this.reject(err);\n      });\n  }\n\n  getResults () {\n    return {\n      log: this.log,\n      stats: this.stats,\n      constraints: this.constraints\n    };\n  }\n\n  addLog (level, msg) {\n    this.logger[level.toLowerCase()](msg);\n    if (msg && typeof msg === 'object') {\n      msg = JSON.stringify(msg);\n    }\n    if (level === 'error') {\n      this.hasError = true;\n    }\n    this.log.push(`${level}: ${msg}`);\n  }\n\n  doGetUserMedia (constraints) {\n    this.addLog('info', { status: 'pending', constraints });\n    return navigator.mediaDevices.getUserMedia(constraints)\n      .then((stream) => {\n        const audioTrack = this.getDeviceName(stream.getAudioTracks());\n        this.addLog('info', {status: 'success', audioTrack});\n        return stream;\n      })\n      .catch(error => {\n        error.pcCode = ERROR_CODES.MEDIA;\n        this.addLog('error', {'status': 'fail', 'error': error});\n        this.addLog('error', `Failed to get access to local media due to error: ${error.name}`);\n        return this.reject(error);\n      });\n  }\n\n  getDeviceName (tracks) {\n    if (tracks.length === 0) {\n      return null;\n    }\n    return tracks[0].label;\n  }\n\n  setupCall (stream) {\n    stream.getTracks().forEach(t => this.call.pc1.pc.addTrack(t, stream));\n\n    return this.call.establishConnection().then(() => {\n      this.addLog('info', { status: 'success', message: 'establishing connection' });\n      this.startTime = new Date();\n      this.localTrack = stream.getAudioTracks()[0];\n    }, (error) => {\n      this.addLog('warn', { status: 'error', error });\n      return Promise.reject(error);\n    });\n  }\n\n  runTest () {\n    return new Promise((resolve, reject) => {\n      this.nextTimeout = setTimeout(() => {\n        this.gatherStats().then(resolve, reject);\n      }, this.statStepMs);\n    });\n  }\n\n  gatherStats () {\n    const now = new Date();\n    if (now - this.startTime > this.durationMs) {\n      return Promise.resolve();\n    }\n    return this.call.pc1.getStats(this.localTrack)\n      .then(this.gotStats.bind(this))\n      .catch((error) => this.addLog('error', 'Failed to getStats: ' + error));\n  }\n\n  gotStats (response) {\n    if (!response) {\n      this.addLog('error', 'Got no response from stats... odd...');\n    } else {\n      const results = typeof response.result === 'function' ? response.result() : response;\n      results.forEach((report) => {\n        if (report.availableOutgoingBitrate) {\n          const value = parseInt(report.availableOutgoingBitrate, 10);\n          this.bweStats.add(new Date(report.timestamp), value);\n        }\n        if (report.totalRoundTripTime || report.roundTripTime) {\n          const value = parseInt(report.totalRoundTripTime || report.roundTripTime, 10);\n          this.rttStats.add(new Date(report.timestamp), value);\n        }\n        if (report.packetsSent) {\n          this.packetsSent = report.packetsSent;\n        }\n        if (report.packetsLost) {\n          this.packetsLost = report.packetsLost;\n        }\n        if (report.frameWidth) {\n          this.videoStats[0] = report.frameWidth;\n        }\n        if (report.frameHeight) {\n          this.videoStats[1] = report.frameHeight;\n        }\n      });\n    }\n\n    return this.runTest();\n  }\n\n  completed () {\n    const stats = this.stats;\n\n    stats.mbpsAvg = this.bweStats.getAverage() / (1000 * 1000);\n    stats.mbpsMax = this.bweStats.getMax() / (1000 * 1000);\n\n    this.addLog('info', `Send bandwidth estimate average: ${stats.mbpsAvg} mpbs`);\n    this.addLog('info', `Send bandwidth estimate max: ${stats.mbpsMax} mbps`);\n\n    stats.rttAverage = this.rttStats.getAverage();\n    stats.rttMax = this.rttStats.getMax();\n    stats.packetsSent = parseInt(this.packetsSent);\n\n    if (this.packetsSent) {\n      stats.packetLoss = parseInt(this.packetsLost || 0, 10) / parseFloat(this.packetsSent);\n    }\n\n    this.addLog('info', `RTT average: ${stats.rttAverage} ms`);\n    this.addLog('info', `RTT max: ${stats.rttMax} ms`);\n    this.addLog('info', `Packets sent: ${stats.rttMax} ms`);\n    this.addLog('info', `Packet loss %: ${stats.packetLoss}`);\n    return this.results;\n  }\n\n  destroy () {\n    super.destroy();\n    window.clearTimeout(this.nextTimeout);\n    if (this.call) {\n      const pc = this.call.pc1;\n      if (pc.getSenders) {\n        pc.getSenders().forEach(sender => sender.track.stop());\n      }\n      if (pc.getTransceivers) {\n        pc.getTransceivers().forEach(t => t.stop());\n      }\n\n      this.call.close();\n      this.call = null;\n    }\n  }\n}\n","import Test from '../utils/Test';\n\nconst LocalMedia = require('localmedia');\nconst MIC_DETECTION_THRESHOLD = -100;\n\nclass AudioTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Audio Test';\n    this.volumeTimeout = this.options.volumeTimeout || 5000;\n\n    this.localMedia = new LocalMedia({detectSpeakingEvents: true});\n  }\n\n  start () {\n    super.start();\n\n    const volumeCheckFailure = window.setTimeout(() => {\n      this.logger.error('No change in mic volume');\n      this.reject(new Error('audio timeout'));\n    }, this.volumeTimeout);\n\n    this.localMedia.start(this.options, (err) => {\n      if (err) {\n        this.logger.error('Audio Local media start failed');\n        this.reject(err);\n      } else {\n        this.logger.log('Audio Local media started');\n      }\n    });\n\n    this.localMedia.on('volumeChange', (volume) => {\n      if (volume > MIC_DETECTION_THRESHOLD) {\n        window.clearTimeout(volumeCheckFailure);\n        this.resolve();\n      }\n    });\n\n    this.localMedia.on('localStream', (stream) => {\n      if (stream.getAudioTracks().length) {\n        var audioTrack = stream.getAudioTracks()[0];\n        if (audioTrack) {\n          this.logger.log('Audio stream passed');\n        } else {\n          this.logger.error('Audio stream failed');\n          this.reject(new Error('no audio tracks available'));\n        }\n      }\n    });\n    return this.promise;\n  }\n\n  destroy () {\n    super.destroy();\n    this.localMedia.stop();\n  }\n}\n\nexport default AudioTest;\n","import Test from '../utils/Test';\n\nconst PeerConnection = require('rtcpeerconnection');\n\nclass ConnectivityTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Connectivity Test';\n  }\n\n  logIceServers () {\n    if (this.options.iceServers) {\n      this.options.iceServers.forEach((iceServer) => {\n        this.logger.log(`Using ICE Server: ${iceServer.urls}`);\n      });\n      if (this.options.iceServers.length === 0) {\n        this.logger.error('no ice servers provided');\n      }\n    } else {\n      this.logger.log('Using default ICE Servers');\n    }\n  }\n\n  start () {\n    super.start();\n    this.logIceServers();\n    this.pc1 = new PeerConnection(this.options);\n    this.pc2 = new PeerConnection(this.options);\n\n    const connectivityCheckFailure = window.setTimeout(() => {\n      this.logger.error('Connectivity timeout error');\n      this.reject(new Error('connectivity timeout'));\n    }, 10000);\n    this.pc2.on('ice', (candidate) => {\n      this.logger.log('pc2 ICE candidate', candidate);\n      this.pc1.processIce(candidate);\n    });\n    this.pc1.on('ice', (candidate) => {\n      this.logger.log('pc1 ICE candidate', candidate);\n      this.pc2.processIce(candidate);\n    });\n    this.pc2.on('answer', (answer) => {\n      this.logger.log('pc2 handle answer');\n      this.pc1.handleAnswer(answer);\n    });\n\n    // when pc1 gets the offer, instantly handle the offer by pc2\n    this.pc1.on('offer', (offer) => {\n      this.logger.log('pc1 offer');\n      this.pc2.handleOffer(offer, (err) => {\n        if (err) {\n          this.logger.error('pc2 failed to handle offer');\n          this.reject(err);\n        }\n        this.logger.log('pc2 handle offer');\n        this.pc2.answer((err, answer) => {\n          if (err) {\n            this.logger.error('pc2 failed answer');\n            this.reject(err);\n          }\n          this.logger.log(`pc2 successful ${answer.type}`);\n        });\n      });\n    });\n    this.dataChannel = this.pc1.createDataChannel('testChannel');\n\n    // generate list of messages to send over data channel\n    const messageQueue = Array.apply(null, { length: 100 }).map((n, i) => {\n      return `message ${i}`;\n    });\n\n    // duplicating this is faster than cloning it\n    const messageQueue2 = Array.apply(null, { length: 100 }).map((n, i) => {\n      return `message ${i}`;\n    });\n\n    let messagesReceived = 0;\n    // when the data channel receives a message, remove it from the queue\n    this.dataChannel.onmessage = (msgEvent) => {\n      const message = messageQueue.find((message) => {\n        return message === msgEvent.data;\n      });\n      this.logger.debug('got a message', message);\n      messageQueue.splice(messageQueue.indexOf(message), 1);\n      messagesReceived++;\n      // when all messages have been received, we're clear\n      if (messageQueue.length === 0) {\n        window.clearTimeout(connectivityCheckFailure);\n        this.logger.log(`Received ${messagesReceived} messages`);\n        this.resolve();\n      }\n    };\n    // when pc2 gets a data channel, send all messageQueue items on it\n    this.pc2.on('addChannel', (channel) => {\n      channel.onopen = () => {\n        this.logger.log(`Sending ${messageQueue.length} messages`);\n        messageQueue2.forEach(channel.send.bind(channel));\n      };\n    });\n\n    // kick it off\n    this.pc1.offer();\n    return this.promise;\n  }\n\n  destroy () {\n    super.destroy();\n    this.pc1.close();\n    this.pc2.close();\n  }\n}\n\nexport default ConnectivityTest;\n","import WebrtcCall from '../utils/WebrtcCall';\nimport Test from '../utils/Test';\n\nclass DataChannelThroughputTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Data Throughput Test';\n    this.testDurationSeconds = 5.0;\n    this.startTime = null;\n    this.sentPayloadBytes = 0;\n    this.receivedPayloadBytes = 0;\n\n    this.stopSending = false;\n\n    const makeString = () => {\n      this.samplePacket = '';\n\n      for (let i = 0; i !== 1024; ++i) {\n        this.samplePacket += 'h';\n      }\n    };\n    makeString();\n\n    this.maxNumberOfPacketsToSend = 1;\n    this.bytesToKeepBuffered = 1024 * this.maxNumberOfPacketsToSend;\n    this.lastBitrateMeasureTime = null;\n    this.lastReceivedPayloadBytes = 0;\n\n    this.call = null;\n    this.senderChannel = null;\n    this.receiveChannel = null;\n  }\n  start () {\n    super.start();\n\n    if (!this.options.iceServers.length) {\n      this.logger.error('No ice servers were provided');\n      this.reject(new Error('No ice servers'));\n    } else {\n      this.call = new WebrtcCall(this.options, this.logger);\n      this.call.setIceCandidateFilter(WebrtcCall.isRelay);\n      this.senderChannel = this.call.pc1.createDataChannel(null);\n      this.senderChannel.addEventListener('open', this.sendingStep.bind(this));\n      this.call.pc2.on('addChannel', this.onReceiverChannel.bind(this));\n\n      this.call.establishConnection();\n    }\n    return this.promise;\n  }\n\n  onReceiverChannel (channel) {\n    this.receiveChannel = channel;\n    this.receiveChannel.addEventListener('message', this.onMessageReceived.bind(this));\n  }\n\n  sendingStep () {\n    const now = new Date();\n    if (!this.startTime) {\n      this.startTime = now;\n      this.lastBitrateMeasureTime = now;\n    }\n\n    for (let i = 0; i !== this.maxNumberOfPacketsToSend; ++i) {\n      if (this.senderChannel.bufferedAmount >= this.bytesToKeepBuffered) {\n        break;\n      }\n      this.sentPayloadBytes += this.samplePacket.length;\n      this.senderChannel.send(this.samplePacket);\n    }\n\n    if (now - this.startTime >= 1000 * this.testDurationSeconds) {\n      this.stopSending = true;\n    } else {\n      this.throughputTimeout = setTimeout(this.sendingStep.bind(this), 1);\n    }\n  }\n\n  onMessageReceived (event) {\n    this.receivedPayloadBytes += event.data.length;\n    const now = new Date();\n    if (now - this.lastBitrateMeasureTime >= 1000) {\n      let bitrate = (this.receivedPayloadBytes - this.lastReceivedPayloadBytes) / (now - this.lastBitrateMeasureTime);\n      bitrate = Math.round(bitrate * 1000 * 8) / 1000;\n      this.logger.log(`Transmitting at ${bitrate} kbps.`);\n      this.lastReceivedPayloadBytes = this.receivedPayloadBytes;\n      this.lastBitrateMeasureTime = now;\n    }\n    if (this.stopSending && this.sentPayloadBytes === this.receivedPayloadBytes) {\n      this.call.close();\n      this.call = null;\n\n      const elapsedTime = Math.round((now - this.startTime) * 10) / 10000.0;\n      const receivedKBits = this.receivedPayloadBytes * 8 / 1000;\n      this.logger.log(`${receivedKBits} kb in ${elapsedTime} seconds.`);\n      this.resolve();\n    }\n  }\n\n  destroy () {\n    super.destroy();\n    window.clearTimeout(this.throughputTimeout);\n    if (this.call) {\n      this.call.close();\n      this.call = null;\n    }\n  }\n}\n\nexport default DataChannelThroughputTest;\n","import Test from '../utils/Test';\nimport parseCandidate from '../utils/parseCandidate';\n\nclass SymmetricNatTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Symmetric Nat Test';\n  }\n\n  start () {\n    super.start();\n\n    const pc = new window.RTCPeerConnection({\n      iceServers: [\n        { urls: 'stun:stun1.l.google.com:19302' },\n        { urls: 'stun:stun2.l.google.com:19302' }\n      ]\n    });\n    pc.createDataChannel('symmetricNatTest');\n    const candidates = {};\n    pc.onicecandidate = (e) => {\n      if (e.candidate && e.candidate.candidate.indexOf('srflx') !== -1) {\n        const candidate = parseCandidate(e.candidate.candidate);\n        this.logger.log('SymmetricNatTest Candidate', candidate);\n        if (!candidates[candidate.relatedPort]) {\n          candidates[candidate.relatedPort] = [];\n        }\n        candidates[candidate.relatedPort].push(candidate.port);\n      } else if (!e.candidate) {\n        const relatedPorts = Object.keys(candidates);\n        if (relatedPorts.length === 1) {\n          const relatedPort = relatedPorts[0];\n          const ports = candidates[relatedPort];\n          this.resolve(ports.length === 1 ? 'nat.asymmetric' : 'nat.symmetric');\n        } else if (relatedPorts.length === 0) {\n          this.resolve('nat.noSrflx');\n        } else {\n          let hasAsymmetric = false;\n          let hasSymmetric = false;\n          for (let i = 0; i < relatedPorts.length; i++) {\n            const relatedPort = relatedPorts[i];\n            const ports = candidates[relatedPort];\n            if (ports.length === 1) {\n              hasAsymmetric = true;\n            } else {\n              hasSymmetric = true;\n            }\n          }\n          if (hasSymmetric && !hasAsymmetric) {\n            this.resolve('nat.symmetric');\n          } else if (!hasSymmetric && hasAsymmetric) {\n            this.resolve('nat.asymmetric');\n          } else if (hasSymmetric && hasAsymmetric) {\n            this.resolve('nat.both');\n          } else {\n            this.resolve('not.noSrflx');\n          }\n        }\n      }\n    };\n    pc.onendofcandidates = pc.onicecandidate.bind(pc, {});\n    pc.createOffer().then(offer => pc.setLocalDescription(offer));\n    return this.promise;\n  }\n\n  destroy () {\n    super.destroy();\n  }\n}\n\nexport default SymmetricNatTest;\n","// adapted from https://github.com/webrtc/testrtc/blob/master/src/js/bandwidth_test.js\n\nimport WebrtcCall from '../utils/WebrtcCall';\nimport Test from '../utils/Test';\nimport StatisticsAggregate from '../utils/StatisticsAggregate';\nimport ERROR_CODES from '../utils/testErrorCodes';\n\nexport default class VideoBandwidthTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Video Bandwidth Test';\n    this.maxVideoBitrateKbps = 2000;\n    this.durationMs = 40000;\n    this.statStepMs = 100;\n    this.bweStats = new StatisticsAggregate(0.75 * this.maxVideoBitrateKbps * 1000);\n    window.bweStats = this.bweStats;\n    this.rttStats = new StatisticsAggregate();\n    this.packetsLost = null;\n    this.videoStats = [];\n    this.startTime = null;\n    this.call = null;\n    // Open the camera with hd resolution specs to get a correct measurement of ramp-up time.\n    this.constraints = {\n      audio: false,\n      video: {\n        width: {\n          min: 640,\n          ideal: 1280,\n          max: 1920\n        },\n        height: {\n          min: 480,\n          ideal: 720,\n          max: 1080\n        }\n      }\n\n    };\n    if (this.options.mediaOptions.video.deviceId) {\n      this.constraints.video.deviceId = this.options.mediaOptions.video.deviceId;\n    }\n\n    this.providedStream = this.options.screenStream;\n\n    this.log = [];\n    this.stats = {};\n  }\n\n  start () {\n    super.start();\n\n    if (!this.options.iceConfig.iceServers.length) {\n      const error = new Error('No ice servers were provided');\n      error.pcCode = ERROR_CODES.ICE;\n      error.details = this.log;\n      return this.reject(error);\n    }\n    this.call = new WebrtcCall(this.options.iceConfig, this.logger);\n    this.call.setIceCandidateFilter(WebrtcCall.isRelay);\n    // FEC makes it hard to study bandwidth estimation since there seems to be\n    // a spike when it is enabled and disabled. Disable it for now. FEC issue\n    // tracked on: https://code.google.com/p/webrtc/issues/detail?id=3050\n    this.call.disableVideoFec();\n    this.call.constrainVideoBitrate(this.maxVideoBitrateKbps);\n\n    let promise;\n    if (this.providedStream) {\n      promise = this.gotStream(this.providedStream);\n    } else {\n      promise = this.doGetUserMedia(this.constraints);\n    }\n\n    return promise.then(() => {\n      const results = this.getResults();\n      if (!this.hasError) {\n        return this.resolve(results);\n      } else {\n        results.error = new Error('Video Bandwidth Error');\n        return this.reject(results);\n      }\n    }, (err) => {\n      err.pcCode = ERROR_CODES.MEDIA;\n      const results = this.getResults();\n      results.error = err;\n      return this.reject(err);\n    });\n  }\n\n  getResults () {\n    return {\n      log: this.log,\n      stats: this.stats,\n      constraints: this.constraints\n    };\n  }\n\n  addLog (level, msg) {\n    this.logger[level.toLowerCase()](msg);\n    if (msg && typeof msg === 'object') {\n      msg = JSON.stringify(msg);\n    }\n    if (level === 'error') {\n      this.hasError = true;\n    }\n    this.log.push(`${level}: ${msg}`);\n  }\n\n  doGetUserMedia (constraints) {\n    this.addLog('info', { status: 'pending', constraints });\n    return navigator.mediaDevices.getUserMedia(constraints).then((stream) => {\n      const camera = this.getDeviceName(stream.getVideoTracks());\n      this.addLog('info', { status: 'success', camera });\n      return this.gotStream(stream);\n    }, (error) => {\n      error.pcCode = ERROR_CODES.MEDIA;\n      this.addLog('error', {'status': 'fail', 'error': error});\n      this.addLog('error', `Failed to get access to local media due to error: ${error.name}`);\n      return this.reject(error);\n    });\n  }\n\n  getDeviceName (tracks) {\n    if (tracks.length === 0) {\n      return null;\n    }\n    return tracks[0].label;\n  }\n\n  gotStream (stream) {\n    stream.getTracks().forEach(t => this.call.pc1.pc.addTrack(t, stream));\n    return this.call.establishConnection().then(() => {\n      this.addLog('info', { status: 'success', message: 'establishing connection' });\n      this.startTime = new Date();\n      this.localStream = stream.getVideoTracks()[0];\n\n      return new Promise((resolve, reject) => {\n        this.nextTimeout = setTimeout(() => {\n          this.gatherStats().then(resolve, reject);\n        }, this.statStepMs);\n      });\n    }, (error) => {\n      this.addLog('warn', { status: 'error', error });\n      return Promise.reject(error);\n    });\n  }\n\n  gatherStats () {\n    const now = new Date();\n    if (now - this.startTime > this.durationMs) {\n      return Promise.resolve(this.completed());\n    }\n    return this.call.pc1.getStats(null)\n      .then(this.gotStats.bind(this), (error) => {\n        this.addLog('error', 'Failed to getStats: ' + error);\n      });\n  }\n\n  gotStats (response) {\n    if (!response) {\n      this.addLog('error', 'Got no response from stats... odd...');\n    } else {\n      const results = typeof response.result === 'function' ? response.result() : response;\n      results.forEach((report) => {\n        if (report.availableOutgoingBitrate) {\n          const value = parseInt(report.availableOutgoingBitrate, 10);\n          this.bweStats.add(new Date(report.timestamp), value);\n        }\n        if (report.totalRoundTripTime || report.roundTripTime) {\n          const value = parseInt(report.totalRoundTripTime || report.roundTripTime, 10);\n          this.rttStats.add(new Date(report.timestamp), value);\n        }\n        if (report.packetsSent) {\n          this.packetsSent = report.packetsSent;\n        }\n        if (report.packetsLost) {\n          this.packetsLost = report.packetsLost;\n        }\n        if (report.frameWidth) {\n          this.videoStats[0] = report.frameWidth;\n        }\n        if (report.frameHeight) {\n          this.videoStats[1] = report.frameHeight;\n        }\n      });\n    }\n    return new Promise((resolve, reject) => {\n      this.nextTimeout = setTimeout(() => {\n        this.gatherStats().then(resolve, reject);\n      }, this.statStepMs);\n    });\n  }\n  completed () {\n    const isWebkit = 'WebkitAppearance' in document.documentElement.style;\n    const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n    const pc = this.call.pc1;\n    if (pc.getSenders) {\n      pc.getSenders().forEach(sender => sender.track.stop());\n    }\n    if (pc.getTransceivers) {\n      pc.getTransceivers().forEach(t => t.stop());\n    }\n    this.call.close();\n    this.call = null;\n    const stats = this.stats;\n\n    if (isWebkit) {\n      // Checking if greater than 2 because Chrome sometimes reports 2x2 when a camera starts but fails to deliver frames.\n      if (this.videoStats[0] < 2 && this.videoStats[1] < 2) {\n        this.addLog('error', `Camera failure: ${this.videoStats[0]}x${this.videoStats[1]}. Cannot test bandwidth without a working camera.`);\n      } else {\n        stats.resolution = `${this.videoStats[0]}x${this.videoStats[1]}`;\n        stats.mbpsAvg = this.bweStats.getAverage() / (1000 * 1000);\n        stats.mbpsMax = this.bweStats.getMax() / (1000 * 1000);\n        stats.rampUpTimeMs = this.bweStats.getRampUpTime();\n\n        this.addLog('info', `Video resolution: ${stats.resolution}`);\n        this.addLog('info', `Send bandwidth estimate average: ${stats.mbpsAvg} mpbs`);\n        this.addLog('info', `Send bandwidth estimate max: ${stats.mbpsMax} mbps`);\n        this.addLog('info', `Send bandwidth ramp-up time: ${stats.rampUpTimeMs} ms`);\n      }\n    } else if (isFirefox) {\n      if (parseInt(this.framerateMean, 10) > 0) {\n        this.addLog('info', `Frame rate mean: ${parseInt(this.framerateMean, 10)}`);\n      } else {\n        this.addLog('error', 'Frame rate mean is 0, cannot test bandwidth without a working camera.');\n      }\n      stats.framerateMean = this.framerateMean || null;\n\n      stats.mbpsAvg = this.bitrateMean / (1000 * 1000);\n      stats.mbpsStdDev = this.bitrateStdDev / (1000 * 1000);\n      this.addLog('info', `Send bitrate mean: ${stats.mbpsAvg} mbps`);\n      this.addLog('info', `Send bitrate standard deviation: ${stats.mbpsStdDev} mbps`);\n    }\n    stats.rttAverage = this.rttStats.getAverage();\n    stats.rttMax = this.rttStats.getMax();\n\n    if (this.packetsSent) {\n      stats.packetLoss = parseInt(this.packetsLost || 0, 10) / parseFloat(this.packetsSent);\n    }\n\n    this.addLog('info', `RTT average: ${stats.rttAverage} ms`);\n    this.addLog('info', `RTT max: ${stats.rttMax} ms`);\n    this.addLog('info', `Lost packets: ${stats.lostPackets}`);\n    return this.results;\n  }\n\n  destroy () {\n    super.destroy();\n    window.clearTimeout(this.nextTimeout);\n    if (this.call) {\n      this.call.close();\n      this.call = null;\n    }\n  }\n}\n","import Test from '../utils/Test';\nconst LocalMedia = require('localmedia');\n\nexport default class VideoTest extends Test {\n  constructor () {\n    super(...arguments);\n    this.name = 'Video Test';\n\n    this.localMedia = new LocalMedia({detectSpeakingEvents: true});\n  }\n\n  start () {\n    super.start();\n\n    this.localMedia.start(this.options, (err) => {\n      if (err) {\n        this.logger.log(`Video Local media start failed ${err.name}`);\n        this.reject(err);\n      } else {\n        this.logger.log('Video Local media started');\n      }\n    });\n\n    this.localMedia.on('localStream', (stream) => {\n      if (stream.getVideoTracks().length) {\n        var videoTrack = stream.getVideoTracks()[0];\n        if (videoTrack) {\n          this.logger.log('Video stream passed');\n          this.resolve();\n        } else {\n          this.logger.error('Video stream failed');\n          this.reject(new Error('no video track available'));\n        }\n      }\n    });\n    return this.promise;\n  }\n\n  destroy () {\n    super.destroy();\n    this.localMedia.stop();\n  }\n}\n","import TestSuite from './utils/TestSuite';\nimport {\n  AudioTest,\n  VideoTest,\n  ConnectivityTest,\n  ThroughputTest,\n  VideoBandwidthTest,\n  AudioBandwidthTest,\n  SymmetricNatTest\n} from './defaultTests';\nimport ERROR_CODES from './utils/testErrorCodes';\n\nmodule.exports = {\n  TestSuite,\n  AudioTest,\n  VideoTest,\n  ConnectivityTest,\n  ThroughputTest,\n  VideoBandwidthTest,\n  AudioBandwidthTest,\n  SymmetricNatTest,\n  ERROR_CODES\n};\n","export default class StatisticsAggregate {\n  constructor (rampUpThreshold) {\n    this.startTime = 0;\n    this.sum = 0;\n    this.count = 0;\n    this.max = 0;\n    this.rampUpThreshold = rampUpThreshold;\n    this.rampUpTime = Infinity;\n  }\n  add (time, datapoint) {\n    if (this.startTime === 0) {\n      this.startTime = time;\n    }\n    this.sum += datapoint;\n    this.max = Math.max(this.max, datapoint);\n    if (this.rampUpTime === Infinity &&\n      datapoint > this.rampUpThreshold) {\n      this.rampUpTime = time;\n    }\n    this.count++;\n  }\n  getAverage () {\n    if (this.count === 0) {\n      return 0;\n    }\n    return this.sum / this.count;\n  }\n  getMax () {\n    return this.max;\n  }\n  getRampUpTime () {\n    return this.rampUpTime - this.startTime;\n  }\n}\n","export default class Test {\n  constructor (options) {\n    this.options = options || {};\n    this.logger = this.options.logger || console;\n    this.promise = new Promise((resolve, reject) => {\n      this.deferred = {resolve, reject};\n    });\n  }\n\n  start () {\n    this.timeout = window.setTimeout(() => {\n      this.reject(new Error('Test Timeout'));\n    }, 45000);\n  }\n\n  resolve (data) {\n    this.deferred.resolve(data);\n    return this.promise;\n  }\n\n  reject (err) {\n    this.deferred.reject(err);\n    return this.promise;\n  }\n\n  destroy () {\n    window.clearTimeout(this.timeout);\n  }\n}\n","export default class TestSuite {\n  constructor (options) {\n    options = options || {};\n    this.allTestsComplete = false;\n    this.stopOnFailure = false;\n    this.running = false;\n    this.queue = [];\n    this.logger = options.logger || console;\n\n    this.hasError = false;\n    this.results = [];\n  }\n\n  addTest (test) {\n    this.queue.push(test);\n  }\n\n  start () {\n    return new Promise((resolve, reject) => {\n      return this.runNextTest().then(() => {\n        if (this.hasError) {\n          const error = new Error('A test failure occurred');\n          error.details = this.results;\n          return reject(error);\n        }\n        return resolve(this.results);\n      }, (err) => {\n        err.details = this.results;\n        return reject(err);\n      });\n    });\n  }\n\n  runNextTest () {\n    this.running = true;\n    const test = this.queue.shift();\n\n    if (!test) {\n      this.running = false;\n      return Promise.resolve();\n    }\n\n    this.activeTest = test;\n    this.logger.log('Starting ' + test.name);\n\n    const next = (err) => {\n      test.running = false;\n      test.destroy();\n      if (err) {\n        this.hasError = true;\n        if (this.stopOnFailure) {\n          return Promise.reject(err);\n        }\n      }\n      return this.runNextTest();\n    };\n\n    return test.start().then((results) => {\n      this.results.push({\n        status: 'passed',\n        name: test.name,\n        results\n      });\n      return next();\n    }, (err) => {\n      this.hasError = true;\n      const errInfo = {\n        status: 'failed',\n        name: test.name,\n        message: err.message,\n        details: err.details\n      };\n      this.results.push(errInfo);\n      this.logger.error('Test failure', errInfo, test);\n      return next(err);\n    });\n  }\n\n  stopAllTests () {\n    this.activeTest.destroy();\n    this.queue = [];\n  }\n}\n","// adapted from https://github.com/webrtc/testrtc\nconst WebrtcStatsGather = require('webrtc-stats-gatherer');\nconst PeerConnection = require('rtcpeerconnection');\n\nclass WebrtcCall {\n  constructor (config, logger) {\n    this.pc1 = new PeerConnection(config);\n    this.pc2 = new PeerConnection(config);\n\n    this.logger = logger;\n\n    this.pc1Gatherer = new WebrtcStatsGather(this.pc1);\n    this.pc1Gatherer.on('stats', stats => this.logger.log('pc1 webrtc stats', stats));\n    this.pc1Gatherer.collectInitialConnectionStats();\n    this.pc1Gatherer.collectStats();\n\n    this.pc2Gatherer = new WebrtcStatsGather(this.pc2);\n    this.pc2Gatherer.on('stats', stats => this.logger.log('pc2 webrtc stats', stats));\n    this.pc2Gatherer.collectInitialConnectionStats();\n    this.pc2Gatherer.collectStats();\n\n    this.pc1.on('ice', candidate => {\n      this.logger.log('webrtc call pc1 candidate', candidate);\n      this.onIceCandidate(this.pc2, candidate);\n    });\n    this.pc2.on('ice', candidate => {\n      this.logger.log('webrtc call pc2 candidate', candidate);\n      this.onIceCandidate(this.pc1, candidate);\n    });\n\n    this.iceCandidateFilter = WebrtcCall.noFilter;\n  }\n\n  establishConnection () {\n    return this.pc1.pc.createOffer().then(this.gotOffer.bind(this), () => this.logger.error(...arguments));\n  }\n\n  close () {\n    this.pc1.close();\n    this.pc2.close();\n  }\n\n  // When the peerConnection is closed the statsCb is called once with an array\n  // of gathered stats.\n  gatherStats (peerConnection, interval) {\n    let stats = [];\n    let statsCollectTime = [];\n\n    return new Promise((resolve, reject) => {\n      const getStats = () => {\n        window.pc = peerConnection;\n        if (peerConnection.signalingState === 'closed') {\n          return resolve({stats, statsCollectTime});\n        }\n        setTimeout(() => {\n          let getStatsTimeout = setTimeout(() => {\n            resolve({stats, statsCollectTime});\n          }, 1000);\n          peerConnection.getStats(null).then((response) => {\n            clearTimeout(getStatsTimeout);\n            getStatsTimeout = null;\n            gotStats(response);\n          });\n        }, interval);\n      };\n\n      const gotStats = (response) => {\n        if (!response) {\n          return getStats();\n        }\n        const now = Date.now();\n        const results = response.result ? response.result() : response;\n        stats = results;\n        statsCollectTime = Object.keys(results).map(() => now);\n        getStats();\n      };\n\n      getStats();\n    });\n  }\n\n  gotOffer (offer) {\n    // if (this.constrainOfferToRemoveVideoFec) {\n    //   offer.sdp = offer.sdp.replace(/(m=video 1 [^\\r]+)(116 117)(\\r\\n)/g, '$1\\r\\n');\n    //   offer.sdp = offer.sdp.replace(/a=rtpmap:116 red\\/90000\\r\\n/g, '');\n    //   offer.sdp = offer.sdp.replace(/a=rtpmap:117 ulpfec\\/90000\\r\\n/g, '');\n    // }\n    this.pc1.pc.setLocalDescription(offer);\n    this.pc2.pc.setRemoteDescription(offer);\n    return this.pc2.pc.createAnswer().then(this.gotAnswer.bind(this), console.error.bind(console));\n  }\n\n  gotAnswer (answer) {\n    if (this.constrainVideoBitrateKbps) {\n      answer.sdp = answer.sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + this.constrainVideoBitrateKbps + '\\r\\n');\n    }\n    this.pc2.pc.setLocalDescription(answer);\n    return this.pc1.pc.setRemoteDescription(answer);\n  }\n\n  onIceCandidate (otherPeer, event) {\n    if (event.candidate) {\n      var parsed = this.parseCandidate(event.candidate.candidate);\n      if (this.iceCandidateFilter(parsed)) {\n        otherPeer.pc.addIceCandidate(event.candidate);\n      }\n    }\n  }\n\n  parseCandidate (text) {\n    const candidateStr = 'candidate:';\n    const pos = text.indexOf(candidateStr) + candidateStr.length;\n    const fields = text.substr(pos).split(' ');\n    return {\n      'type': fields[7],\n      'protocol': fields[2],\n      'address': fields[4]\n    };\n  }\n\n  setIceCandidateFilter (filter) {\n    this.iceCandidateFilter = filter;\n  }\n\n  // Remove video FEC if available on the offer.\n  disableVideoFec () {\n    this.constrainOfferToRemoveVideoFec = true;\n  }\n\n  // Constraint max video bitrate by modifying the SDP when creating an answer.\n  constrainVideoBitrate (maxVideoBitrateKbps) {\n    this.constrainVideoBitrateKbps = maxVideoBitrateKbps;\n  }\n\n  static noFilter () {\n    return true;\n  }\n\n  static isRelay (candidate) {\n    return candidate.type === 'relay';\n  }\n}\n\nexport default WebrtcCall;\n","// parseCandidate from https://github.com/fippo/sdp\nfunction parseCandidate (line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      default: // Unknown extensions are silently ignored.\n        break;\n    }\n  }\n  return candidate;\n}\n\nexport default parseCandidate;\n","const ICE = 1;\nconst MEDIA = 2;\n\nmodule.exports = {\n  ICE,\n  MEDIA\n};\n"],"sourceRoot":""}